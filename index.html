<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة الاستثمار المتطور</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3f37c9;
            --secondary-color: #4cc9f0;
            --success-color: #2ecc71;
            --info-color: #3498db;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --dark-color: #1e2a3a;
            --light-color: #f8f9fa;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --sidebar-width: 280px;
            --header-height: 70px;
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            --transition-speed: 0.3s;
            --font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-family);
        }

        body {
            background-color: var(--gray-100);
            color: var(--gray-800);
            font-family: var(--font-family);
            direction: rtl;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-200);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-500);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-600);
        }

        /* Sidebar */
        .app-container {
            display: flex;
            width: 100%;
            min-height: 100vh;
        }

        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(180deg, var(--dark-color) 0%, var(--gray-800) 100%);
            color: white;
            position: fixed;
            top: 0;
            right: 0;
            z-index: 1000;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            height: var(--header-height);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-color);
            color: white;
            font-size: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-category {
            padding: 10px 25px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--gray-500);
            margin-top: 15px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 25px;
            color: var(--gray-300);
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            position: relative;
            border-right: 4px solid transparent;
            transition: all var(--transition-speed) ease;
            margin: 2px 0;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }

        .menu-item.active {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-right-color: var(--primary-color);
        }

        .menu-icon {
            margin-left: 15px;
            font-size: 18px;
            width: 25px;
            text-align: center;
        }

        .menu-badge {
            position: absolute;
            left: 25px;
            background: var(--danger-color);
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 50px;
        }

        .sidebar-footer {
            padding: 15px 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-user {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: white;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        .logout-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-400);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Content Area */
        .content {
            flex: 1;
            margin-right: var(--sidebar-width);
            padding: 0 20px 20px;
            transition: all var(--transition-speed) ease;
        }

        .header {
            height: var(--header-height);
            background: white;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            margin: 20px 0;
            box-shadow: var(--box-shadow);
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-bar {
            position: relative;
        }

        .search-input {
            width: 300px;
            border: none;
            background: var(--gray-100);
            border-radius: 50px;
            padding: 10px 40px 10px 15px;
            font-size: 0.9rem;
            transition: all var(--transition-speed) ease;
        }

        .search-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--primary-light);
            background: white;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-600);
        }

        .notification-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            position: relative;
        }

        .notification-btn:hover {
            background: var(--gray-200);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            left: -5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--danger-color);
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-toggle {
            display: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gray-100);
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }

        .menu-toggle:hover {
            background: var(--gray-200);
        }

        /* Dashboard Section */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            transition: all var(--transition-speed) ease;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .card-title {
            font-size: 1rem;
            color: var(--gray-600);
            font-weight: 600;
            margin-bottom: 5px;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 5px;
        }

        .card-change {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .card-change.up {
            color: var(--success-color);
        }

        .card-change.down {
            color: var(--danger-color);
        }

        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .card-bg {
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            height: 150px;
            opacity: 0.05;
            z-index: 0;
        }

        .card-icon.primary, .card-bg.primary {
            background: var(--primary-color);
        }

        .card-icon.success, .card-bg.success {
            background: var(--success-color);
        }

        .card-icon.warning, .card-bg.warning {
            background: var(--warning-color);
        }

        .card-icon.danger, .card-bg.danger {
            background: var(--danger-color);
        }

        .card-icon.info, .card-bg.info {
            background: var(--info-color);
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: white;
            border-radius: var(--border-radius);
            padding: 5px;
            margin-bottom: 20px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            box-shadow: var(--box-shadow);
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            padding: 12px 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            border-radius: var(--border-radius-sm);
            transition: all var(--transition-speed) ease;
            white-space: nowrap;
        }

        .tab:hover {
            color: var(--primary-color);
            background: var(--gray-100);
        }

        .tab.active {
            background: var(--primary-color);
            color: white;
        }

        /* Charts */
        .chart-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .chart-actions {
            display: flex;
            gap: 10px;
        }

        /* Grid Layout */
        .grid-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            padding: 15px;
            text-align: right;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-600);
            border-bottom: 2px solid var(--gray-200);
        }

        .table td {
            padding: 15px;
            text-align: right;
            font-size: 0.9rem;
            color: var(--gray-800);
            border-bottom: 1px solid var(--gray-200);
        }

        .table tbody tr {
            transition: all var(--transition-speed) ease;
        }

        .table tbody tr:hover {
            background: var(--gray-100);
        }

        .table tbody tr:last-child td {
            border-bottom: none;
        }

        .status {
            padding: 5px 10px;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
            display: inline-block;
        }

        .status.active {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success-color);
        }

        .status.pending {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning-color);
        }

        .status.closed {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 20px;
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            border: none;
            outline: none;
            gap: 8px;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.85rem;
        }

        .btn-lg {
            padding: 12px 25px;
            font-size: 1rem;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 50%;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }

        .btn-outline-primary {
            background: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-outline-primary:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }

        .btn-info {
            background: var(--info-color);
            color: white;
        }

        .btn-info:hover {
            background: #2980b9;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-light {
            background: var(--gray-200);
            color: var(--gray-800);
        }

        .btn-light:hover {
            background: var(--gray-300);
        }

        .btn-dark {
            background: var(--gray-800);
            color: white;
        }

        .btn-dark:hover {
            background: var(--gray-900);
            box-shadow: 0 5px 15px rgba(33, 37, 41, 0.3);
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin: 0 3px;
        }

        /* Forms */
        .form-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            margin-bottom: 30px;
        }

        .form-header {
            margin-bottom: 20px;
        }

        .form-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 5px;
        }

        .form-subtitle {
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--gray-700);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            font-size: 0.95rem;
            transition: all var(--transition-speed) ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            font-size: 0.95rem;
            transition: all var(--transition-speed) ease;
            background: white;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: left 15px center;
            background-size: 15px;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-check {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .form-check-input {
            width: 18px;
            height: 18px;
            margin-left: 10px;
            accent-color: var(--primary-color);
        }

        .form-check-label {
            font-size: 0.9rem;
            color: var(--gray-700);
        }

        .form-text {
            font-size: 0.8rem;
            color: var(--gray-600);
            margin-top: 5px;
        }

        .form-error {
            font-size: 0.8rem;
            color: var(--danger-color);
            margin-top: 5px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-speed) ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            opacity: 0;
            transition: all var(--transition-speed) ease;
            position: relative;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
            opacity: 1;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-200);
            color: var(--gray-600);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }

        .modal-close:hover {
            background: var(--gray-300);
            color: var(--gray-800);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid var(--gray-200);
        }

        /* Tabs within Modal */
        .modal-tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 20px;
        }

        .modal-tab {
            padding: 10px 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all var(--transition-speed) ease;
        }

        .modal-tab:hover {
            color: var(--primary-color);
        }

        .modal-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .modal-tab-content {
            display: none;
        }

        .modal-tab-content.active {
            display: block;
        }

        /* Notifications */
        .notification-panel {
            position: fixed;
            top: 0;
            left: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: all var(--transition-speed) ease;
            overflow-y: auto;
        }

        .notification-panel.active {
            left: 0;
        }

        .notification-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
        }

        .notification-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .notification-list {
            padding: 20px;
        }

        .notification-item {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            border-radius: var(--border-radius-sm);
            margin-bottom: 10px;
            background: var(--gray-100);
            transition: all var(--transition-speed) ease;
            cursor: pointer;
        }

        .notification-item:hover {
            background: var(--gray-200);
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-left: 15px;
            flex-shrink: 0;
        }

        .notification-info {
            flex: 1;
        }

        .notification-text {
            font-size: 0.9rem;
            color: var(--gray-800);
            margin-bottom: 5px;
        }

        .notification-time {
            font-size: 0.8rem;
            color: var(--gray-600);
        }

        .notification-actions {
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        /* Hide all pages except the active one */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Alert */
        .alert {
            padding: 15px;
            border-radius: var(--border-radius-sm);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .alert-text {
            font-size: 0.9rem;
        }

        .alert-success {
            background: rgba(46, 204, 113, 0.1);
            border-right: 4px solid var(--success-color);
        }

        .alert-success .alert-icon {
            background: var(--success-color);
        }

        .alert-success .alert-title {
            color: var(--success-color);
        }

        .alert-danger {
            background: rgba(231, 76, 60, 0.1);
            border-right: 4px solid var(--danger-color);
        }

        .alert-danger .alert-icon {
            background: var(--danger-color);
        }

        .alert-danger .alert-title {
            color: var(--danger-color);
        }

        .alert-warning {
            background: rgba(243, 156, 18, 0.1);
            border-right: 4px solid var(--warning-color);
        }

        .alert-warning .alert-icon {
            background: var(--warning-color);
        }

        .alert-warning .alert-title {
            color: var(--warning-color);
        }

        .alert-info {
            background: rgba(52, 152, 219, 0.1);
            border-right: 4px solid var(--info-color);
        }

        .alert-info .alert-icon {
            background: var(--info-color);
        }

        .alert-info .alert-title {
            color: var(--info-color);
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--gray-200);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .grid-layout {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(var(--sidebar-width));
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .content {
                margin-right: 0;
            }

            .menu-toggle {
                display: flex;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .search-input {
                width: 200px;
            }
        }

        @media (max-width: 576px) {
            .search-input {
                width: 150px;
            }

            .notification-panel {
                width: 100%;
                left: -100%;
            }

            .notification-panel.active {
                left: 0;
            }

            .modal {
                width: 95%;
            }
        }

        /* Print Styles */
        @media print {
            .sidebar, .header-actions, .modal-overlay, .notification-panel {
                display: none !important;
            }

            .content {
                margin: 0 !important;
                padding: 0 !important;
            }

            .page {
                display: block !important;
            }

            body {
                background: white !important;
            }

            .card, .table-container, .form-container, .chart-container {
                box-shadow: none !important;
                border: 1px solid var(--gray-300) !important;
            }

            .btn {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="logo-text">نظام الاستثمار</div>
                </div>
            </div>
            <div class="sidebar-menu">
                <div class="menu-category">لوحة التحكم</div>
                <a href="#dashboard" class="menu-item active" onclick="showPage('dashboard')">
                    <span class="menu-icon"><i class="fas fa-tachometer-alt"></i></span>
                    <span>الرئيسية</span>
                </a>
                <a href="#analytics" class="menu-item" onclick="showPage('analytics')">
                    <span class="menu-icon"><i class="fas fa-chart-bar"></i></span>
                    <span>التحليلات</span>
                </a>

                <div class="menu-category">إدارة الاستثمار</div>
                <a href="#investors" class="menu-item" onclick="showPage('investors')">
                    <span class="menu-icon"><i class="fas fa-users"></i></span>
                    <span>المستثمرين</span>
                </a>
                <a href="#investments" class="menu-item" onclick="showPage('investments')">
                    <span class="menu-icon"><i class="fas fa-money-bill-wave"></i></span>
                    <span>الاستثمارات</span>
                </a>
                <a href="#profits" class="menu-item" onclick="showPage('profits')">
                    <span class="menu-icon"><i class="fas fa-hand-holding-usd"></i></span>
                    <span>الأرباح</span>
                </a>
                <a href="#operations" class="menu-item" onclick="showPage('operations')">
                    <span class="menu-icon"><i class="fas fa-exchange-alt"></i></span>
                    <span>العمليات</span>
                    <span class="menu-badge" id="operationsBadge">3</span>
                </a>

                <div class="menu-category">التقارير</div>
                <a href="#reports" class="menu-item" onclick="showPage('reports')">
                    <span class="menu-icon"><i class="fas fa-file-alt"></i></span>
                    <span>التقارير</span>
                </a>
                <a href="#financial" class="menu-item" onclick="showPage('financial')">
                    <span class="menu-icon"><i class="fas fa-file-invoice-dollar"></i></span>
                    <span>التقارير المالية</span>
                </a>

                <div class="menu-category">النظام</div>
                <a href="#calendar" class="menu-item" onclick="showPage('calendar')">
                    <span class="menu-icon"><i class="fas fa-calendar-alt"></i></span>
                    <span>التقويم</span>
                </a>
                <a href="#notifications" class="menu-item" onclick="toggleNotificationPanel()">
                    <span class="menu-icon"><i class="fas fa-bell"></i></span>
                    <span>الإشعارات</span>
                    <span class="menu-badge" id="notificationBadge">5</span>
                </a>
                <a href="#settings" class="menu-item" onclick="showPage('settings')">
                    <span class="menu-icon"><i class="fas fa-cog"></i></span>
                    <span>الإعدادات</span>
                </a>
            </div>
            <div class="sidebar-footer">
                <div class="sidebar-user">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name">المدير</div>
                        <div class="user-role">مسؤول النظام</div>
                    </div>
                </div>
                <div class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="header">
                    <h1 class="page-title">لوحة التحكم</h1>
                    <div class="header-actions">
                        <div class="search-bar">
                            <input type="text" class="search-input" placeholder="بحث...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <div class="notification-btn" onclick="toggleNotificationPanel()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">5</span>
                        </div>
                        <div class="menu-toggle" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info">
                    <div class="alert-icon">
                        <i class="fas fa-info"></i>
                    </div>
                    <div class="alert-content">
                        <div class="alert-title">مرحباً بك في النظام</div>
                        <div class="alert-text">يوجد هناك 3 عمليات جديدة تحتاج للمراجعة، و5 إشعارات جديدة.</div>
                    </div>
                </div>

                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-bg primary">
                            <i class="fas fa-users fa-4x"></i>
                        </div>
                        <div class="card-header">
                            <div>
                                <div class="card-title">إجمالي المستثمرين</div>
                                <div class="card-value" id="totalInvestors">24</div>
                                <div class="card-change up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>15% منذ الشهر الماضي</span>
                                </div>
                            </div>
                            <div class="card-icon primary">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-bg success">
                            <i class="fas fa-money-bill-wave fa-4x"></i>
                        </div>
                        <div class="card-header">
                            <div>
                                <div class="card-title">إجمالي الاستثمارات</div>
                                <div class="card-value" id="totalInvestments">245,000,000 د.ع</div>
                                <div class="card-change up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>8% منذ الشهر الماضي</span>
                                </div>
                            </div>
                            <div class="card-icon success">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-bg warning">
                            <i class="fas fa-hand-holding-usd fa-4x"></i>
                        </div>
                        <div class="card-header">
                            <div>
                                <div class="card-title">إجمالي الأرباح</div>
                                <div class="card-value" id="totalProfits">4,287,500 د.ع</div>
                                <div class="card-change up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>12% منذ الشهر الماضي</span>
                                </div>
                            </div>
                            <div class="card-icon warning">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-bg info">
                            <i class="fas fa-exchange-alt fa-4x"></i>
                        </div>
                        <div class="card-header">
                            <div>
                                <div class="card-title">عدد المعاملات</div>
                                <div class="card-value" id="totalTransactions">68</div>
                                <div class="card-change up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>5% منذ الشهر الماضي</span>
                                </div>
                            </div>
                            <div class="card-icon info">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid-layout">
                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title">تحليل الاستثمارات والأرباح</div>
                            <div class="chart-actions">
                                <button class="btn btn-sm btn-light">اليومي</button>
                                <button class="btn btn-sm btn-primary">الشهري</button>
                                <button class="btn btn-sm btn-light">السنوي</button>
                            </div>
                        </div>
                        <div id="investmentChart" style="height: 300px; width: 100%;">
                            <!-- Chart will be rendered here -->
                            <div style="height: 300px; width: 100%; display: flex; align-items: center; justify-content: center;">
                                <div style="text-align: center; color: var(--gray-600);">
                                    <i class="fas fa-chart-line fa-3x" style="margin-bottom: 10px;"></i>
                                    <p>سيتم عرض الرسم البياني هنا</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">أحدث المستثمرين</div>
                            <button class="btn btn-sm btn-primary" onclick="showPage('investors')">عرض الكل</button>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>المستثمر</th>
                                    <th>المبلغ</th>
                                    <th>التاريخ</th>
                                </tr>
                            </thead>
                            <tbody id="recentInvestorsBody">
                                <tr>
                                    <td>أحمد محمد</td>
                                    <td>15,000,000 د.ع</td>
                                    <td>05/05/2025</td>
                                </tr>
                                <tr>
                                    <td>سارة أحمد</td>
                                    <td>10,000,000 د.ع</td>
                                    <td>01/05/2025</td>
                                </tr>
                                <tr>
                                    <td>محمد علي</td>
                                    <td>25,000,000 د.ع</td>
                                    <td>28/04/2025</td>
                                </tr>
                                <tr>
                                    <td>فاطمة حسين</td>
                                    <td>12,000,000 د.ع</td>
                                    <td>25/04/2025</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">آخر المعاملات</div>
                        <div class="table-actions">
                            <button class="btn btn-sm btn-light" onclick="printTable('recentTransactionsTable')">
                                <i class="fas fa-print"></i> طباعة
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="showPage('operations')">عرض الكل</button>
                        </div>
                    </div>
                    <table class="table" id="recentTransactionsTable">
                        <thead>
                            <tr>
                                <th>المستثمر</th>
                                <th>العملية</th>
                                <th>المبلغ</th>
                                <th>التاريخ</th>
                                <th>الحالة</th>
                            </tr>
                        </thead>
                        <tbody id="recentTransactionsBody">
                            <tr>
                                <td>أحمد محمد</td>
                                <td>استثمار جديد</td>
                                <td>15,000,000 د.ع</td>
                                <td>05/05/2025</td>
                                <td><span class="status active">مكتمل</span></td>
                            </tr>
                            <tr>
                                <td>سارة أحمد</td>
                                <td>دفع أرباح</td>
                                <td>175,000 د.ع</td>
                                <td>03/05/2025</td>
                                <td><span class="status active">مكتمل</span></td>
                            </tr>
                            <tr>
                                <td>محمد علي</td>
                                <td>سحب جزئي</td>
                                <td>5,000,000 د.ع</td>
                                <td>01/05/2025</td>
                                <td><span class="status pending">معلق</span></td>
                            </tr>
                            <tr>
                                <td>فاطمة حسين</td>
                                <td>استثمار جديد</td>
                                <td>12,000,000 د.ع</td>
                                <td>25/04/2025</td>
                                <td><span class="status active">مكتمل</span></td>
                            </tr>
                            <tr>
                                <td>علي حسن</td>
                                <td>إغلاق استثمار</td>
                                <td>8,000,000 د.ع</td>
                                <td>20/04/2025</td>
                                <td><span class="status closed">مغلق</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analytics" class="page">
                <div class="header">
                    <h1 class="page-title">التحليلات</h1>
                    <div class="header-actions">
                        <div class="search-bar">
                            <input type="text" class="search-input" placeholder="بحث...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <div class="notification-btn" onclick="toggleNotificationPanel()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">5</span>
                        </div>
                        <div class="menu-toggle" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </div>
                    </div>
                </div>

                <div class="tabs">
                    <div class="tab active" onclick="switchAnalyticsTab('overview')">نظرة عامة</div>
                    <div class="tab" onclick="switchAnalyticsTab('investments')">الاستثمارات</div>
                    <div class="tab" onclick="switchAnalyticsTab('profits')">الأرباح</div>
                    <div class="tab" onclick="switchAnalyticsTab('investors')">المستثمرين</div>
                    <div class="tab" onclick="switchAnalyticsTab('trends')">الاتجاهات</div>
                </div>

                <div id="analyticsOverview" class="analytics-tab-content active">
                    <div class="dashboard-cards">
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">معدل النمو الشهري</div>
                                    <div class="card-value">12.5%</div>
                                    <div class="card-change up">
                                        <i class="fas fa-arrow-up"></i>
                                        <span>3.2% من الشهر السابق</span>
                                    </div>
                                </div>
                                <div class="card-icon primary">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">متوسط الاستثمار</div>
                                    <div class="card-value">10,208,333 د.ع</div>
                                    <div class="card-change up">
                                        <i class="fas fa-arrow-up"></i>
                                        <span>5.8% من الشهر السابق</span>
                                    </div>
                                </div>
                                <div class="card-icon success">
                                    <i class="fas fa-calculator"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">نسبة الاحتفاظ</div>
                                    <div class="card-value">92%</div>
                                    <div class="card-change down">
                                        <i class="fas fa-arrow-down"></i>
                                        <span>1.5% من الشهر السابق</span>
                                    </div>
                                </div>
                                <div class="card-icon warning">
                                    <i class="fas fa-user-check"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">إجمالي العائد</div>
                                    <div class="card-value">4,287,500 د.ع</div>
                                    <div class="card-change up">
                                        <i class="fas fa-arrow-up"></i>
                                        <span>7.3% من الشهر السابق</span>
                                    </div>
                                </div>
                                <div class="card-icon info">
                                    <i class="fas fa-percentage"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title">تحليل الأداء</div>
                            <div class="chart-actions">
                                <button class="btn btn-sm btn-light">اليومي</button>
                                <button class="btn btn-sm btn-primary">الشهري</button>
                                <button class="btn btn-sm btn-light">السنوي</button>
                                <button class="btn btn-sm btn-light"><i class="fas fa-download"></i> تصدير</button>
                            </div>
                        </div>
                        <div id="performanceChart" style="height: 400px; width: 100%;">
                            <!-- Chart will be rendered here -->
                            <div style="height: 400px; width: 100%; display: flex; align-items: center; justify-content: center;">
                                <div style="text-align: center; color: var(--gray-600);">
                                    <i class="fas fa-chart-bar fa-3x" style="margin-bottom: 10px;"></i>
                                    <p>سيتم عرض الرسم البياني هنا</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="analyticsInvestments" class="analytics-tab-content">
                    <!-- Investments Tab Content -->
                </div>

                <div id="analyticsProfits" class="analytics-tab-content">
                    <!-- Profits Tab Content -->
                </div>

                <div id="analyticsInvestors" class="analytics-tab-content">
                    <!-- Investors Tab Content -->
                </div>

                <div id="analyticsTrends" class="analytics-tab-content">
                    <!-- Trends Tab Content -->
                </div>
            </div>

            <!-- Investors Page -->
            <div id="investors" class="page">
                <div class="header">
                    <h1 class="page-title">المستثمرين</h1>
                    <div class="header-actions">
                        <div class="search-bar">
                            <input type="text" class="search-input" placeholder="بحث عن مستثمر...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <button class="btn btn-primary" onclick="openAddInvestorModal()">
                            <i class="fas fa-plus"></i> إضافة مستثمر
                        </button>
                        <div class="notification-btn" onclick="toggleNotificationPanel()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">5</span>
                        </div>
                        <div class="menu-toggle" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">قائمة المستثمرين</div>
                        <div class="table-actions">
                            <button class="btn btn-light" onclick="exportInvestors()">
                                <i class="fas fa-file-export"></i> تصدير
                            </button>
                            <button class="btn btn-light" onclick="importInvestors()">
                                <i class="fas fa-file-import"></i> استيراد
                            </button>
                            <button class="btn btn-light" onclick="printTable('investorsTable')">
                                <i class="fas fa-print"></i> طباعة
                            </button>
                        </div>
                    </div>
                    <table class="table" id="investorsTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>الاسم</th>
                                <th>رقم الهاتف</th>
                                <th>العنوان</th>
                                <th>رقم البطاقة</th>
                                <th>إجمالي الاستثمار</th>
                                <th>إجمالي الأرباح</th>
                                <th>تاريخ الانضمام</th>
                                <th>إجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="investorsTableBody">
                            <tr>
                                <td>1</td>
                                <td>أحمد محمد</td>
                                <td>07701234567</td>
                                <td>الحلة، بابل</td>
                                <td>A12345678</td>
                                <td>15,000,000 د.ع</td>
                                <td>262,500 د.ع</td>
                                <td>01/01/2025</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewInvestor(1)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-warning btn-icon action-btn" onclick="editInvestor(1)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-icon action-btn" onclick="deleteInvestor(1)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>سارة أحمد</td>
                                <td>07709876543</td>
                                <td>بغداد</td>
                                <td>B87654321</td>
                                <td>10,000,000 د.ع</td>
                                <td>175,000 د.ع</td>
                                <td>15/01/2025</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewInvestor(2)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-warning btn-icon action-btn" onclick="editInvestor(2)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-icon action-btn" onclick="deleteInvestor(2)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>محمد علي</td>
                                <td>07712345678</td>
                                <td>النجف</td>
                                <td>C23456789</td>
                                <td>25,000,000 د.ع</td>
                                <td>437,500 د.ع</td>
                                <td>01/02/2025</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewInvestor(3)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-warning btn-icon action-btn" onclick="editInvestor(3)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-icon action-btn" onclick="deleteInvestor(3)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Investments Page -->
            <div id="investments" class="page">
                <div class="header">
                    <h1 class="page-title">الاستثمارات</h1>
                    <div class="header-actions">
                        <div class="search-bar">
                            <input type="text" class="search-input" placeholder="بحث...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <button class="btn btn-primary" onclick="openNewInvestmentModal()">
                            <i class="fas fa-plus"></i> استثمار جديد
                        </button>
                        <div class="notification-btn" onclick="toggleNotificationPanel()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">5</span>
                        </div>
                        <div class="menu-toggle" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </div>
                    </div>
                </div>

                <div class="tabs">
                    <div class="tab active" onclick="switchInvestmentsTab('active')">الاستثمارات النشطة</div>
                    <div class="tab" onclick="switchInvestmentsTab('closed')">الاستثمارات المغلقة</div>
                    <div class="tab" onclick="switchInvestmentsTab('all')">جميع الاستثمارات</div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">الاستثمارات النشطة</div>
                        <div class="table-actions">
                            <button class="btn btn-light" onclick="exportInvestments()">
                                <i class="fas fa-file-export"></i> تصدير
                            </button>
                            <button class="btn btn-light" onclick="printTable('investmentsTable')">
                                <i class="fas fa-print"></i> طباعة
                            </button>
                        </div>
                    </div>
                    <table class="table" id="investmentsTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>المستثمر</th>
                                <th>المبلغ</th>
                                <th>تاريخ الاستثمار</th>
                                <th>الربح الشهري</th>
                                <th>إجمالي الأرباح</th>
                                <th>الحالة</th>
                                <th>إجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="investmentsTableBody">
                            <tr>
                                <td>1</td>
                                <td>أحمد محمد</td>
                                <td>15,000,000 د.ع</td>
                                <td>01/01/2025</td>
                                <td>262,500 د.ع</td>
                                <td>1,050,000 د.ع</td>
                                <td><span class="status active">نشط</span></td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewInvestment(1)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-warning btn-icon action-btn" onclick="openWithdrawModal(1)">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <button class="btn btn-success btn-icon action-btn" onclick="openPayProfitModal(1)">
                                        <i class="fas fa-money-bill"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>سارة أحمد</td>
                                <td>10,000,000 د.ع</td>
                                <td>15/01/2025</td>
                                <td>175,000 د.ع</td>
                                <td>612,500 د.ع</td>
                                <td><span class="status active">نشط</span></td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewInvestment(2)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-warning btn-icon action-btn" onclick="openWithdrawModal(2)">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <button class="btn btn-success btn-icon action-btn" onclick="openPayProfitModal(2)">
                                        <i class="fas fa-money-bill"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>محمد علي</td>
                                <td>25,000,000 د.ع</td>
                                <td>01/02/2025</td>
                                <td>437,500 د.ع</td>
                                <td>1,312,500 د.ع</td>
                                <td><span class="status active">نشط</span></td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewInvestment(3)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-warning btn-icon action-btn" onclick="openWithdrawModal(3)">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <button class="btn btn-success btn-icon action-btn" onclick="openPayProfitModal(3)">
                                        <i class="fas fa-money-bill"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Profits Page -->
            <div id="profits" class="page">
                <div class="header">
                    <h1 class="page-title">الأرباح</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openPayProfitModal()">
                            <i class="fas fa-money-bill"></i> دفع أرباح
                        </button>
                        <div class="notification-btn" onclick="toggleNotificationPanel()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">5</span>
                        </div>
                        <div class="menu-toggle" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </div>
                    </div>
                </div>

                <div class="tabs">
                    <div class="tab active" onclick="switchProfitsTab('summary')">ملخص الأرباح</div>
                    <div class="tab" onclick="switchProfitsTab('paid')">الأرباح المدفوعة</div>
                    <div class="tab" onclick="switchProfitsTab('due')">الأرباح المستحقة</div>
                    <div class="tab" onclick="switchProfitsTab('projections')">توقعات الأرباح</div>
                </div>

                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">إجمالي الأرباح</div>
                                <div class="card-value">4,287,500 د.ع</div>
                                <div class="card-change up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>12% منذ الشهر الماضي</span>
                                </div>
                            </div>
                            <div class="card-icon primary">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">الأرباح المدفوعة</div>
                                <div class="card-value">1,312,500 د.ع</div>
                                <div class="card-change up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>8% منذ الشهر الماضي</span>
                                </div>
                            </div>
                            <div class="card-icon success">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">الأرباح المستحقة</div>
                                <div class="card-value">2,975,000 د.ع</div>
                                <div class="card-change up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>15% منذ الشهر الماضي</span>
                                </div>
                            </div>
                            <div class="card-icon warning">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">متوسط العائد الشهري</div>
                                <div class="card-value">1.75%</div>
                                <div class="card-change">
                                    <i class="fas fa-minus"></i>
                                    <span>ثابت</span>
                                </div>
                            </div>
                            <div class="card-icon info">
                                <i class="fas fa-percentage"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">تحليل الأرباح</div>
                        <div class="chart-actions">
                            <button class="btn btn-sm btn-light">اليومي</button>
                            <button class="btn btn-sm btn-primary">الشهري</button>
                            <button class="btn btn-sm btn-light">السنوي</button>
                            <button class="btn btn-sm btn-light"><i class="fas fa-download"></i> تصدير</button>
                        </div>
                    </div>
                    <div id="profitsChart" style="height: 300px; width: 100%;">
                        <!-- Chart will be rendered here -->
                        <div style="height: 300px; width: 100%; display: flex; align-items: center; justify-content: center;">
                            <div style="text-align: center; color: var(--gray-600);">
                                <i class="fas fa-chart-line fa-3x" style="margin-bottom: 10px;"></i>
                                <p>سيتم عرض الرسم البياني هنا</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">تفاصيل الأرباح</div>
                        <div class="table-actions">
                            <button class="btn btn-light" onclick="exportProfits()">
                                <i class="fas fa-file-export"></i> تصدير
                            </button>
                            <button class="btn btn-light" onclick="printTable('profitsTable')">
                                <i class="fas fa-print"></i> طباعة
                            </button>
                        </div>
                    </div>
                    <table class="table" id="profitsTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>المستثمر</th>
                                <th>مبلغ الاستثمار</th>
                                <th>تاريخ الاستثمار</th>
                                <th>الربح الشهري</th>
                                <th>إجمالي الأرباح</th>
                                <th>الأرباح المدفوعة</th>
                                <th>الأرباح المستحقة</th>
                                <th>إجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="profitsTableBody">
                            <tr>
                                <td>1</td>
                                <td>أحمد محمد</td>
                                <td>15,000,000 د.ع</td>
                                <td>01/01/2025</td>
                                <td>262,500 د.ع</td>
                                <td>1,050,000 د.ع</td>
                                <td>525,000 د.ع</td>
                                <td>525,000 د.ع</td>
                                <td>
                                    <button class="btn btn-success btn-icon action-btn" onclick="openPayProfitModal(1)">
                                        <i class="fas fa-money-bill"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>سارة أحمد</td>
                                <td>10,000,000 د.ع</td>
                                <td>15/01/2025</td>
                                <td>175,000 د.ع</td>
                                <td>612,500 د.ع</td>
                                <td>175,000 د.ع</td>
                                <td>437,500 د.ع</td>
                                <td>
                                    <button class="btn btn-success btn-icon action-btn" onclick="openPayProfitModal(2)">
                                        <i class="fas fa-money-bill"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>محمد علي</td>
                                <td>25,000,000 د.ع</td>
                                <td>01/02/2025</td>
                                <td>437,500 د.ع</td>
                                <td>1,312,500 د.ع</td>
                                <td>437,500 د.ع</td>
                                <td>875,000 د.ع</td>
                                <td>
                                    <button class="btn btn-success btn-icon action-btn" onclick="openPayProfitModal(3)">
                                        <i class="fas fa-money-bill"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Operations Page -->
            <div id="operations" class="page">
                <div class="header">
                    <h1 class="page-title">العمليات</h1>
                    <div class="header-actions">
                        <div class="search-bar">
                            <input type="text" class="search-input" placeholder="بحث...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <div class="notification-btn" onclick="toggleNotificationPanel()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">5</span>
                        </div>
                        <div class="menu-toggle" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </div>
                    </div>
                </div>

                <div class="tabs">
                    <div class="tab active" onclick="switchOperationsTab('all')">جميع العمليات</div>
                    <div class="tab" onclick="switchOperationsTab('investments')">الاستثمارات</div>
                    <div class="tab" onclick="switchOperationsTab('withdrawals')">السحوبات</div>
                    <div class="tab" onclick="switchOperationsTab('profits')">الأرباح</div>
                    <div class="tab" onclick="switchOperationsTab('pending')">معلقة</div>
                </div>

                <div class="form-container">
                    <div class="form-header">
                        <h2 class="form-title">إجراء عملية جديدة</h2>
                        <p class="form-subtitle">اختر نوع العملية التي تريد إجراءها</p>
                    </div>
                    <div class="form-row">
                        <button class="btn btn-success" onclick="openNewInvestmentModal()">
                            <i class="fas fa-plus"></i> استثمار جديد
                        </button>
                        <button class="btn btn-warning" onclick="openWithdrawModal()">
                            <i class="fas fa-minus"></i> سحب
                        </button>
                        <button class="btn btn-primary" onclick="openPayProfitModal()">
                            <i class="fas fa-money-bill"></i> دفع أرباح
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">سجل العمليات</div>
                        <div class="table-actions">
                            <button class="btn btn-light" onclick="exportOperations()">
                                <i class="fas fa-file-export"></i> تصدير
                            </button>
                            <button class="btn btn-light" onclick="printTable('operationsTable')">
                                <i class="fas fa-print"></i> طباعة
                            </button>
                        </div>
                    </div>
                    <table class="table" id="operationsTable">
                        <thead>
                            <tr>
                                <th>رقم العملية</th>
                                <th>المستثمر</th>
                                <th>نوع العملية</th>
                                <th>المبلغ</th>
                                <th>التاريخ</th>
                                <th>الوقت</th>
                                <th>الحالة</th>
                                <th>ملاحظات</th>
                                <th>إجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="operationsTableBody">
                            <tr>
                                <td>OP-2025-001</td>
                                <td>أحمد محمد</td>
                                <td>استثمار جديد</td>
                                <td>15,000,000 د.ع</td>
                                <td>01/01/2025</td>
                                <td>10:30:45</td>
                                <td><span class="status active">مكتمل</span></td>
                                <td>استثمار جديد</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewOperation('OP-2025-001')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>OP-2025-002</td>
                                <td>سارة أحمد</td>
                                <td>استثمار جديد</td>
                                <td>10,000,000 د.ع</td>
                                <td>15/01/2025</td>
                                <td>11:45:22</td>
                                <td><span class="status active">مكتمل</span></td>
                                <td>استثمار جديد</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewOperation('OP-2025-002')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>OP-2025-003</td>
                                <td>محمد علي</td>
                                <td>استثمار جديد</td>
                                <td>25,000,000 د.ع</td>
                                <td>01/02/2025</td>
                                <td>09:15:10</td>
                                <td><span class="status active">مكتمل</span></td>
                                <td>استثمار جديد</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewOperation('OP-2025-003')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>OP-2025-004</td>
                                <td>أحمد محمد</td>
                                <td>دفع أرباح</td>
                                <td>262,500 د.ع</td>
                                <td>01/02/2025</td>
                                <td>14:22:30</td>
                                <td><span class="status active">مكتمل</span></td>
                                <td>دفع الأرباح الشهرية</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewOperation('OP-2025-004')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>OP-2025-005</td>
                                <td>سارة أحمد</td>
                                <td>دفع أرباح</td>
                                <td>175,000 د.ع</td>
                                <td>15/02/2025</td>
                                <td>10:05:15</td>
                                <td><span class="status active">مكتمل</span></td>
                                <td>دفع الأرباح الشهرية</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewOperation('OP-2025-005')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>OP-2025-006</td>
                                <td>محمد علي</td>
                                <td>سحب جزئي</td>
                                <td>5,000,000 د.ع</td>
                                <td>01/05/2025</td>
                                <td>09:30:00</td>
                                <td><span class="status pending">معلق</span></td>
                                <td>سحب جزئي بطلب من المستثمر</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewOperation('OP-2025-006')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-success btn-icon action-btn" onclick="approveOperation('OP-2025-006')">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button class="btn btn-danger btn-icon action-btn" onclick="rejectOperation('OP-2025-006')">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reports" class="page">
                <div class="header">
                    <h1 class="page-title">التقارير</h1>
                    <div class="header-actions">
                        <div class="notification-btn" onclick="toggleNotificationPanel()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">5</span>
                        </div>
                        <div class="menu-toggle" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </div>
                    </div>
                </div>

                <div class="form-container">
                    <div class="form-header">
                        <h2 class="form-title">إنشاء تقرير مخصص</h2>
                        <p class="form-subtitle">قم بتحديد نوع التقرير والفترة الزمنية</p>
                    </div>
                    <form id="customReportForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">نوع التقرير</label>
                                <select class="form-select" id="reportType" required>
                                  <option value="">اختر نوع التقرير</option>
                                    <option value="investors">المستثمرين</option>
                                    <option value="investments">الاستثمارات</option>
                                    <option value="profits">الأرباح</option>
                                    <option value="operations">العمليات</option>
                                    <option value="financial">التقرير المالي</option>
                                    <option value="summary">ملخص عام</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">المستثمر (اختياري)</label>
                                <select class="form-select" id="reportInvestor">
                                    <option value="">جميع المستثمرين</option>
                                    <!-- Will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">من تاريخ</label>
                                <input type="date" class="form-control" id="reportFromDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">إلى تاريخ</label>
                                <input type="date" class="form-control" id="reportToDate">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">تنسيق التقرير</label>
                            <div class="form-row">
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" id="formatTable" name="reportFormat" value="table" checked>
                                    <label class="form-check-label" for="formatTable">جدول</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" id="formatChart" name="reportFormat" value="chart">
                                    <label class="form-check-label" for="formatChart">رسم بياني</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" id="formatPdf" name="reportFormat" value="pdf">
                                    <label class="form-check-label" for="formatPdf">PDF</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-file-alt"></i> إنشاء التقرير
                            </button>
                            <button type="reset" class="btn btn-light">
                                <i class="fas fa-redo"></i> إعادة تعيين
                            </button>
                        </div>
                    </form>
                </div>

                <div class="tabs">
                    <div class="tab active" onclick="switchReportsTab('recent')">التقارير الأخيرة</div>
                    <div class="tab" onclick="switchReportsTab('saved')">التقارير المحفوظة</div>
                    <div class="tab" onclick="switchReportsTab('scheduled')">التقارير المجدولة</div>
                </div>

                <div class="table-container" id="recentReports">
                    <div class="table-header">
                        <div class="table-title">التقارير الأخيرة</div>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>اسم التقرير</th>
                                <th>النوع</th>
                                <th>تاريخ الإنشاء</th>
                                <th>المنشئ</th>
                                <th>إجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>تقرير الأرباح الشهري</td>
                                <td>الأرباح</td>
                                <td>01/05/2025</td>
                                <td>المدير</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewReport(1)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-primary btn-icon action-btn" onclick="downloadReport(1)">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="btn btn-danger btn-icon action-btn" onclick="deleteReport(1)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>تقرير المستثمرين النشطين</td>
                                <td>المستثمرين</td>
                                <td>28/04/2025</td>
                                <td>المدير</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewReport(2)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-primary btn-icon action-btn" onclick="downloadReport(2)">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="btn btn-danger btn-icon action-btn" onclick="deleteReport(2)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>تقرير العمليات الأسبوعي</td>
                                <td>العمليات</td>
                                <td>25/04/2025</td>
                                <td>المدير</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewReport(3)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-primary btn-icon action-btn" onclick="downloadReport(3)">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="btn btn-danger btn-icon action-btn" onclick="deleteReport(3)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="table-container" id="reportResult" style="display: none;">
                    <div class="table-header">
                        <div class="table-title" id="reportTitle">نتائج التقرير</div>
                        <div class="table-actions">
                            <button class="btn btn-light" onclick="printTable('reportTable')">
                                <i class="fas fa-print"></i> طباعة
                            </button>
                            <button class="btn btn-primary" onclick="saveReport()">
                                <i class="fas fa-save"></i> حفظ التقرير
                            </button>
                            <button class="btn btn-light" onclick="closeReport()">
                                <i class="fas fa-times"></i> إغلاق
                            </button>
                        </div>
                    </div>
                    <div id="reportContent">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Financial Reports Page -->
            <div id="financial" class="page">
                <div class="header">
                    <h1 class="page-title">التقارير المالية</h1>
                    <div class="header-actions">
                        <div class="search-bar">
                            <input type="text" class="search-input" placeholder="بحث...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <div class="notification-btn" onclick="toggleNotificationPanel()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">5</span>
                        </div>
                        <div class="menu-toggle" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </div>
                    </div>
                </div>

                <div class="tabs">
                    <div class="tab active" onclick="switchFinancialTab('summary')">ملخص مالي</div>
                    <div class="tab" onclick="switchFinancialTab('income')">تقرير الدخل</div>
                    <div class="tab" onclick="switchFinancialTab('cashflow')">التدفق النقدي</div>
                    <div class="tab" onclick="switchFinancialTab('projections')">التوقعات المالية</div>
                </div>

                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">إجمالي الدخل</div>
                                <div class="card-value">250,000,000 د.ع</div>
                                <div class="card-change up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>10% منذ الشهر الماضي</span>
                                </div>
                            </div>
                            <div class="card-icon primary">
                                <i class="fas fa-money-check-alt"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">إجمالي المصروفات</div>
                                <div class="card-value">1,500,000 د.ع</div>
                                <div class="card-change up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>5% منذ الشهر الماضي</span>
                                </div>
                            </div>
                            <div class="card-icon danger">
                                <i class="fas fa-file-invoice"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">صافي الربح</div>
                                <div class="card-value">4,287,500 د.ع</div>
                                <div class="card-change up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>12% منذ الشهر الماضي</span>
                                </div>
                            </div>
                            <div class="card-icon success">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">الرصيد الحالي</div>
                                <div class="card-value">248,500,000 د.ع</div>
                                <div class="card-change up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>9.8% منذ الشهر الماضي</span>
                                </div>
                            </div>
                            <div class="card-icon info">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid-layout">
                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title">تحليل الإيرادات والمصروفات</div>
                            <div class="chart-actions">
                                <button class="btn btn-sm btn-light">اليومي</button>
                                <button class="btn btn-sm btn-primary">الشهري</button>
                                <button class="btn btn-sm btn-light">السنوي</button>
                                <button class="btn btn-sm btn-light"><i class="fas fa-download"></i> تصدير</button>
                            </div>
                        </div>
                        <div id="financialChart" style="height: 300px; width: 100%;">
                            <!-- Chart will be rendered here -->
                            <div style="height: 300px; width: 100%; display: flex; align-items: center; justify-content: center;">
                                <div style="text-align: center; color: var(--gray-600);">
                                    <i class="fas fa-chart-bar fa-3x" style="margin-bottom: 10px;"></i>
                                    <p>سيتم عرض الرسم البياني هنا</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">ملخص الدخل</div>
                            <button class="btn btn-sm btn-primary" onclick="generateIncomeReport()">
                                <i class="fas fa-file-export"></i> تقرير كامل
                            </button>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>البند</th>
                                    <th>المبلغ</th>
                                    <th>التغيير</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>اشتراكات المستثمرين</td>
                                    <td>245,000,000 د.ع</td>
                                    <td><span class="card-change up"><i class="fas fa-arrow-up"></i> 8%</span></td>
                                </tr>
                                <tr>
                                    <td>عمولات الخدمات</td>
                                    <td>5,000,000 د.ع</td>
                                    <td><span class="card-change up"><i class="fas fa-arrow-up"></i> 15%</span></td>
                                </tr>
                                <tr>
                                    <td>مصاريف التشغيل</td>
                                    <td>1,200,000 د.ع</td>
                                    <td><span class="card-change up"><i class="fas fa-arrow-up"></i> 3%</span></td>
                                </tr>
                                <tr>
                                    <td>مصاريف الموظفين</td>
                                    <td>300,000 د.ع</td>
                                    <td><span class="card-change up"><i class="fas fa-arrow-up"></i> 5%</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="form-container">
                    <div class="form-header">
                        <h2 class="form-title">تقرير مالي مخصص</h2>
                        <p class="form-subtitle">قم بتحديد نوع التقرير والفترة الزمنية</p>
                    </div>
                    <form id="financialReportForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">نوع التقرير</label>
                                <select class="form-select" id="financialReportType" required>
                                    <option value="">اختر نوع التقرير</option>
                                    <option value="income">تقرير الدخل</option>
                                    <option value="expense">تقرير المصروفات</option>
                                    <option value="cashflow">تقرير التدفق النقدي</option>
                                    <option value="profit">تقرير الأرباح والخسائر</option>
                                    <option value="balance">تقرير الميزانية</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">الفترة</label>
                                <select class="form-select" id="financialReportPeriod" required>
                                    <option value="">اختر الفترة</option>
                                    <option value="daily">يومي</option>
                                    <option value="weekly">أسبوعي</option>
                                    <option value="monthly">شهري</option>
                                    <option value="quarterly">ربع سنوي</option>
                                    <option value="yearly">سنوي</option>
                                    <option value="custom">مخصص</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row" id="customDateRange" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">من تاريخ</label>
                                <input type="date" class="form-control" id="financialFromDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">إلى تاريخ</label>
                                <input type="date" class="form-control" id="financialToDate">
                            </div>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-file-alt"></i> إنشاء التقرير
                            </button>
                            <button type="reset" class="btn btn-light">
                                <i class="fas fa-redo"></i> إعادة تعيين
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Calendar Page -->
            <div id="calendar" class="page">
                <div class="header">
                    <h1 class="page-title">التقويم</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="addEvent()">
                            <i class="fas fa-plus"></i> إضافة حدث
                        </button>
                        <div class="notification-btn" onclick="toggleNotificationPanel()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">5</span>
                        </div>
                        <div class="menu-toggle" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </div>
                    </div>
                </div>

                <div class="tabs">
                    <div class="tab active" onclick="switchCalendarView('month')">شهري</div>
                    <div class="tab" onclick="switchCalendarView('week')">أسبوعي</div>
                    <div class="tab" onclick="switchCalendarView('day')">يومي</div>
                    <div class="tab" onclick="switchCalendarView('agenda')">الأجندة</div>
                </div>

                <div class="form-container">
                    <div class="form-row">
                        <div class="form-group">
                            <button class="btn btn-light" onclick="prevMonth()">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="form-group" style="flex: 1; text-align: center;">
                            <h2 id="currentMonth">مايو 2025</h2>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-light" onclick="nextMonth()">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="calendar-container" style="background: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow); padding: 20px; margin-bottom: 30px;">
                    <div class="calendar-header" style="display: grid; grid-template-columns: repeat(7, 1fr); margin-bottom: 10px;">
                        <div class="calendar-day-name" style="text-align: center; font-weight: 600; padding: 10px;">الأحد</div>
                        <div class="calendar-day-name" style="text-align: center; font-weight: 600; padding: 10px;">الإثنين</div>
                        <div class="calendar-day-name" style="text-align: center; font-weight: 600; padding: 10px;">الثلاثاء</div>
                        <div class="calendar-day-name" style="text-align: center; font-weight: 600; padding: 10px;">الأربعاء</div>
                        <div class="calendar-day-name" style="text-align: center; font-weight: 600; padding: 10px;">الخميس</div>
                        <div class="calendar-day-name" style="text-align: center; font-weight: 600; padding: 10px;">الجمعة</div>
                        <div class="calendar-day-name" style="text-align: center; font-weight: 600; padding: 10px;">السبت</div>
                    </div>
                    <div class="calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); grid-template-rows: repeat(5, 1fr); gap: 5px; height: 600px;">
                        <!-- Calendar will be rendered here -->
                        <!-- Example of a day cell -->
                        <div class="calendar-day" style="background: var(--gray-100); border-radius: var(--border-radius-sm); padding: 10px; min-height: 100px; position: relative;">
                            <div class="day-number" style="font-weight: 600;">1</div>
                            <div class="day-events">
                                <div class="event" style="background: var(--primary-color); color: white; padding: 5px; border-radius: 4px; margin-top: 5px; font-size: 0.8rem;">
                                    دفع أرباح
                                </div>
                            </div>
                        </div>
                        <!-- More day cells will be added by JavaScript -->
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">الأحداث القادمة</div>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>العنوان</th>
                                <th>التاريخ</th>
                                <th>الوقت</th>
                                <th>النوع</th>
                                <th>ملاحظات</th>
                                <th>إجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>دفع أرباح - أحمد محمد</td>
                                <td>01/06/2025</td>
                                <td>10:00</td>
                                <td>دفع أرباح</td>
                                <td>دفع الأرباح الشهرية</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewEvent(1)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-warning btn-icon action-btn" onclick="editEvent(1)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-icon action-btn" onclick="deleteEvent(1)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>اجتماع المستثمرين</td>
                                <td>15/06/2025</td>
                                <td>14:00</td>
                                <td>اجتماع</td>
                                <td>مناقشة خطة الاستثمار للربع القادم</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewEvent(2)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-warning btn-icon action-btn" onclick="editEvent(2)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-icon action-btn" onclick="deleteEvent(2)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>تجديد عقد استثمار - محمد علي</td>
                                <td>01/07/2025</td>
                                <td>11:30</td>
                                <td>عقد</td>
                                <td>تجديد عقد استثمار لمدة سنة</td>
                                <td>
                                    <button class="btn btn-info btn-icon action-btn" onclick="viewEvent(3)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-warning btn-icon action-btn" onclick="editEvent(3)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger btn-icon action-btn" onclick="deleteEvent(3)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page">
                <div class="header">
                    <h1 class="page-title">الإعدادات</h1>
                    <div class="header-actions">
                        <div class="notification-btn" onclick="toggleNotificationPanel()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">5</span>
                        </div>
                        <div class="menu-toggle" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </div>
                    </div>
                </div>

                <div class="tabs">
                    <div class="tab active" onclick="switchSettingsTab('general')">عام</div>
                    <div class="tab" onclick="switchSettingsTab('investment')">الاستثمار</div>
                    <div class="tab" onclick="switchSettingsTab('profile')">الملف الشخصي</div>
                    <div class="tab" onclick="switchSettingsTab('notifications')">الإشعارات</div>
                    <div class="tab" onclick="switchSettingsTab('backup')">النسخ الاحتياطي</div>
                    <div class="tab" onclick="switchSettingsTab('system')">النظام</div>
                </div>

                <div id="generalSettings" class="settings-tab-content active">
                    <div class="form-container">
                        <div class="form-header">
                            <h2 class="form-title">إعدادات عامة</h2>
                            <p class="form-subtitle">إعدادات النظام الأساسية</p>
                        </div>
                        <form id="generalSettingsForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">اسم الشركة</label>
                                    <input type="text" class="form-control" id="companyName" value="شركة الاستثمار العراقية">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">شعار الشركة</label>
                                    <input type="file" class="form-control" id="companyLogo">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">عنوان الشركة</label>
                                    <input type="text" class="form-control" id="companyAddress" value="الحلة، بابل، العراق">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">رقم الهاتف</label>
                                    <input type="text" class="form-control" id="companyPhone" value="07701234567">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">البريد الإلكتروني</label>
                                    <input type="email" class="form-control" id="companyEmail" value="info@iraqinvest.com">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">الموقع الإلكتروني</label>
                                    <input type="text" class="form-control" id="companyWebsite" value="www.iraqinvest.com">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">اللغة</label>
                                    <select class="form-select" id="language">
                                        <option value="ar" selected>العربية</option>
                                        <option value="en">الإنجليزية</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">المنطقة الزمنية</label>
                                    <select class="form-select" id="timezone">
                                        <option value="Asia/Baghdad" selected>بغداد (GMT+3)</option>
                                        <option value="Asia/Dubai">دبي (GMT+4)</option>
                                        <option value="Europe/London">لندن (GMT+0)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> حفظ الإعدادات
                                </button>
                                <button type="reset" class="btn btn-light">
                                    <i class="fas fa-redo"></i> إعادة تعيين
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="investmentSettings" class="settings-tab-content">
                    <div class="form-container">
                        <div class="form-header">
                            <h2 class="form-title">إعدادات الاستثمار</h2>
                            <p class="form-subtitle">إعدادات الاستثمار والأرباح</p>
                        </div>
                        <form id="investmentSettingsForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">نسبة الربح الشهرية (%)</label>
                                    <input type="number" class="form-control" id="monthlyProfitRate" step="0.01" value="1.75" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">الحد الأدنى للاستثمار</label>
                                    <input type="number" class="form-control" id="minInvestment" value="1000000" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">فترة توزيع الأرباح</label>
                                    <select class="form-select" id="profitDistributionPeriod">
                                        <option value="monthly" selected>شهرياً</option>
                                        <option value="quarterly">ربع سنوي</option>
                                        <option value="yearly">سنوياً</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">يوم توزيع الأرباح</label>
                                    <input type="number" class="form-control" id="profitDistributionDay" min="1" max="31" value="1" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">رسوم السحب المبكر (%)</label>
                                    <input type="number" class="form-control" id="earlyWithdrawalFee" step="0.01" value="0.5" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">الحد الأقصى للسحب الجزئي (%)</label>
                                    <input type="number" class="form-control" id="maxPartialWithdrawal" step="1" value="50" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">عملة النظام</label>
                                    <select class="form-select" id="currency">
                                        <option value="IQD" selected>دينار عراقي</option>
                                        <option value="USD">دولار أمريكي</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">العملات المقبولة</label>
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" id="acceptIQD" checked>
                                        <label class="form-check-label" for="acceptIQD">دينار عراقي</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" id="acceptUSD" checked>
                                        <label class="form-check-label" for="acceptUSD">دولار أمريكي</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> حفظ الإعدادات
                                </button>
                                <button type="reset" class="btn btn-light">
                                    <i class="fas fa-redo"></i> إعادة تعيين
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="profileSettings" class="settings-tab-content">
                    <!-- Profile Settings Content -->
                </div>

                <div id="notificationSettings" class="settings-tab-content">
                    <!-- Notification Settings Content -->
                </div>

                <div id="backupSettings" class="settings-tab-content">
                    <div class="form-container">
                        <div class="form-header">
                            <h2 class="form-title">النسخ الاحتياطي واستعادة البيانات</h2>
                            <p class="form-subtitle">إدارة البيانات والنسخ الاحتياطي</p>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">إنشاء نسخة احتياطية</label>
                                <button class="btn btn-primary" onclick="createBackup()">
                                    <i class="fas fa-download"></i> إنشاء نسخة احتياطية
                                </button>
                                <p class="form-text">قم بإنشاء نسخة احتياطية كاملة من جميع بيانات النظام.</p>
                            </div>
                            <div class="form-group">
                                <label class="form-label">النسخ الاحتياطية التلقائية</label>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="autoBackup" checked>
                                    <label class="form-check-label" for="autoBackup">تفعيل النسخ الاحتياطي التلقائي</label>
                                </div>
                                <select class="form-select" id="autoBackupFrequency" style="margin-top: 10px;">
                                    <option value="daily">يومياً</option>
                                    <option value="weekly" selected>أسبوعياً</option>
                                    <option value="monthly">شهرياً</option>
                                </select>
                                <p class="form-text">سيتم إنشاء نسخة احتياطية تلقائياً حسب الجدول المحدد.</p>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">استعادة من نسخة احتياطية</label>
                                <input type="file" class="form-control" id="restoreFile" accept=".json">
                                <button class="btn btn-warning" onclick="restoreBackup()" style="margin-top: 10px;">
                                    <i class="fas fa-upload"></i> استعادة
                                </button>
                                <p class="form-text">تحذير: سيتم استبدال جميع البيانات الحالية بالبيانات من النسخة الاحتياطية.</p>
                            </div>
                            <div class="form-group">
                                <label class="form-label">النسخ الاحتياطية السابقة</label>
                                <select class="form-select" id="previousBackups" size="5" style="height: auto;">
                                    <option value="backup_20250505.json">05/05/2025 - 10:30</option>
                                    <option value="backup_20250428.json">28/04/2025 - 09:15</option>
                                    <option value="backup_20250421.json">21/04/2025 - 11:45</option>
                                    <option value="backup_20250414.json">14/04/2025 - 16:20</option>
                                    <option value="backup_20250407.json">07/04/2025 - 08:30</option>
                                </select>
                                <div style="margin-top: 10px;">
                                    <button class="btn btn-light btn-sm" onclick="downloadSelectedBackup()">
                                        <i class="fas fa-download"></i> تنزيل
                                    </button>
                                    <button class="btn btn-light btn-sm" onclick="restoreSelectedBackup()">
                                        <i class="fas fa-upload"></i> استعادة
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteSelectedBackup()">
                                        <i class="fas fa-trash"></i> حذف
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">تصدير البيانات</label>
                            <div class="form-row">
                                <button class="btn btn-light" onclick="exportInvestors()">
                                    <i class="fas fa-file-export"></i> المستثمرين
                                </button>
                                <button class="btn btn-light" onclick="exportInvestments()">
                                    <i class="fas fa-file-export"></i> الاستثمارات
                                </button>
                                <button class="btn btn-light" onclick="exportOperations()">
                                    <i class="fas fa-file-export"></i> العمليات
                                </button>
                                <button class="btn btn-light" onclick="exportReports()">
                                    <i class="fas fa-file-export"></i> التقارير
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="systemSettings" class="settings-tab-content">
                    <!-- System Settings Content -->
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Panel -->
    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <h2 class="notification-title">الإشعارات</h2>
            <div class="modal-close" onclick="toggleNotificationPanel()">
                <i class="fas fa-times"></i>
            </div>
        </div>
        <div class="notification-list">
            <div class="notification-item">
                <div class="notification-icon" style="background: var(--primary-color);">
                    <i class="fas fa-user-plus"></i>
                </div>
                <div class="notification-info">
                    <div class="notification-text">تم إضافة مستثمر جديد: أحمد محمد</div>
                    <div class="notification-time">منذ 30 دقيقة</div>
                </div>
            </div>
            <div class="notification-item">
                <div class="notification-icon" style="background: var(--success-color);">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="notification-info">
                    <div class="notification-text">تم إجراء استثمار جديد بقيمة 15,000,000 د.ع</div>
                    <div class="notification-time">منذ ساعتين</div>
                </div>
            </div>
            <div class="notification-item">
                <div class="notification-icon" style="background: var(--warning-color);">
                    <i class="fas fa-calendar-day"></i>
                </div>
                <div class="notification-info">
                    <div class="notification-text">موعد دفع الأرباح الشهرية بعد 3 أيام</div>
                    <div class="notification-time">منذ 5 ساعات</div>
                </div>
            </div>
            <div class="notification-item">
                <div class="notification-icon" style="background: var(--info-color);">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="notification-info">
                    <div class="notification-text">تم إنشاء تقرير الأرباح الشهري</div>
                    <div class="notification-time">منذ يوم واحد</div>
                </div>
            </div>
            <div class="notification-item">
                <div class="notification-icon" style="background: var(--danger-color);">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="notification-info">
                    <div class="notification-text">طلب سحب معلق بحاجة للموافقة</div>
                    <div class="notification-time">منذ يومين</div>
                </div>
            </div>
        </div>
        <div class="notification-actions">
            <button class="btn btn-light" onclick="markAllAsRead()">
                <i class="fas fa-check-double"></i> تعيين الكل كمقروء
            </button>
        </div>
    </div>

    <!-- Add Investor Modal -->
    <div class="modal-overlay" id="addInvestorModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">إضافة مستثمر جديد</h2>
                <div class="modal-close" onclick="closeModal('addInvestorModal')">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="modal-body">
                <div class="modal-tabs">
                    <div class="modal-tab active" onclick="switchModalTab('investorInfo', 'addInvestorModal')">معلومات المستثمر</div>
                    <div class="modal-tab" onclick="switchModalTab('investmentInfo', 'addInvestorModal')">معلومات الاستثمار</div>
                    <div class="modal-tab" onclick="switchModalTab('documents', 'addInvestorModal')">المستندات</div>
                </div>
                <div class="modal-tab-content active" id="investorInfo">
                    <form id="investorForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">الاسم الكامل</label>
                                <input type="text" class="form-control" id="investorName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">رقم الهاتف</label>
                                <input type="text" class="form-control" id="investorPhone" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">البريد الإلكتروني</label>
                                <input type="email" class="form-control" id="investorEmail">
                            </div>
                            <div class="form-group">
                                <label class="form-label">تاريخ الميلاد</label>
                                <input type="date" class="form-control" id="investorBirthdate">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">العنوان</label>
                                <input type="text" class="form-control" id="investorAddress" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">المدينة</label>
                                <input type="text" class="form-control" id="investorCity" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">رقم البطاقة الشخصية</label>
                                <input type="text" class="form-control" id="investorIdCard" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">تاريخ إصدار البطاقة</label>
                                <input type="date" class="form-control" id="investorIdCardDate">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">المهنة</label>
                                <input type="text" class="form-control" id="investorOccupation">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ملاحظات</label>
                                <textarea class="form-control" id="investorNotes" rows="3"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-tab-content" id="investmentInfo">
                    <form id="initialInvestmentForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">المبلغ (دينار عراقي)</label>
                                <input type="number" class="form-control" id="initialInvestmentAmount" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">تاريخ الاستثمار</label>
                                <input type="date" class="form-control" id="initialInvestmentDate" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">طريقة الدفع</label>
                                <select class="form-select" id="initialInvestmentMethod">
                                    <option value="cash">نقداً</option>
                                    <option value="check">شيك</option>
                                    <option value="transfer">حوالة بنكية</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">رقم المرجع</label>
                                <input type="text" class="form-control" id="initialInvestmentReference">
                                <p class="form-text">رقم الشيك أو رقم الحوالة إن وجد</p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">الربح الشهري المتوقع</label>
                            <input type="text" class="form-control" id="initialExpectedProfit" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ملاحظات</label>
                            <textarea class="form-control" id="initialInvestmentNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-tab-content" id="documents">
                    <div class="form-group">
                        <label class="form-label">صورة البطاقة الشخصية</label>
                        <input type="file" class="form-control" id="investorIdCardImage">
                    </div>
                    <div class="form-group">
                        <label class="form-label">عقد الاستثمار</label>
                        <input type="file" class="form-control" id="investmentContractFile">
                    </div>
                    <div class="form-group">
                        <label class="form-label">مستندات إضافية</label>
                        <input type="file" class="form-control" id="additionalDocuments" multiple>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" onclick="closeModal('addInvestorModal')">إلغاء</button>
                <button class="btn btn-primary" onclick="saveInvestor()">حفظ المستثمر</button>
            </div>
        </div>
    </div>

    <!-- New Investment Modal -->
    <div class="modal-overlay" id="newInvestmentModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">استثمار جديد</h2>
                <div class="modal-close" onclick="closeModal('newInvestmentModal')">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="modal-body">
                <form id="newInvestmentForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">المستثمر</label>
                            <select class="form-select" id="investmentInvestor" required>
                                <option value="">اختر المستثمر</option>
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">المبلغ (دينار عراقي)</label>
                            <input type="number" class="form-control" id="investmentAmount" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">تاريخ الاستثمار</label>
                            <input type="date" class="form-control" id="investmentDate" required>
                            <div id="daysMessage" class="form-text" style="color: var(--warning-color);"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">طريقة الدفع</label>
                            <select class="form-select" id="investmentMethod">
                                <option value="cash">نقداً</option>
                                <option value="check">شيك</option>
                                <option value="transfer">حوالة بنكية</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">رقم المرجع</label>
                            <input type="text" class="form-control" id="investmentReference">
                        </div>
                        <div class="form-group">
                            <label class="form-label">الربح الشهري المتوقع</label>
                            <input type="text" class="form-control" id="expectedProfit" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ملاحظات</label>
                        <textarea class="form-control" id="investmentNotes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" onclick="closeModal('newInvestmentModal')">إلغاء</button>
                <button class="btn btn-primary" onclick="saveInvestment()">تأكيد الاستثمار</button>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="modal-overlay" id="withdrawModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">سحب مبلغ</h2>
                <div class="modal-close" onclick="closeModal('withdrawModal')">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="modal-body">
                <form id="withdrawForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">المستثمر</label>
                            <select class="form-select" id="withdrawInvestor" required>
                                <option value="">اختر المستثمر</option>
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">الاستثمار</label>
                            <select class="form-select" id="withdrawInvestment" required>
                                <option value="">اختر الاستثمار</option>
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">المبلغ المتاح للسحب</label>
                            <input type="text" class="form-control" id="availableAmount" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">المبلغ المراد سحبه</label>
                            <input type="number" class="form-control" id="withdrawAmount" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">تاريخ السحب</label>
                            <input type="date" class="form-control" id="withdrawDate" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">طريقة السحب</label>
                            <select class="form-select" id="withdrawMethod">
                                <option value="cash">نقداً</option>
                                <option value="check">شيك</option>
                                <option value="transfer">حوالة بنكية</option>
                            </select>
                        </div>
                    </div>
                    <div class="alert alert-warning">
                        <div class="alert-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">تنبيه</div>
                            <div class="alert-text">سيتم إلغاء الفائدة الشهرية للمبلغ المسحوب فقط.</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ملاحظات</label>
                        <textarea class="form-control" id="withdrawNotes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" onclick="closeModal('withdrawModal')">إلغاء</button>
                <button class="btn btn-warning" onclick="saveWithdrawal()">تأكيد السحب</button>
            </div>
        </div>
    </div>

    <!-- Pay Profit Modal -->
    <div class="modal-overlay" id="payProfitModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">دفع أرباح</h2>
                <div class="modal-close" onclick="closeModal('payProfitModal')">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="modal-body">
                <form id="payProfitForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">المستثمر</label>
                            <select class="form-select" id="profitInvestor" required>
                                <option value="">اختر المستثمر</option>
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">الفترة</label>
                            <select class="form-select" id="profitPeriod" required>
                                <option value="current">الشهر الحالي</option>
                                <option value="previous">الشهر السابق</option>
                                <option value="custom">فترة مخصصة</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row" id="customProfitPeriod" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">من تاريخ</label>
                            <input type="date" class="form-control" id="profitFromDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">إلى تاريخ</label>
                            <input type="date" class="form-control" id="profitToDate">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">إجمالي الأرباح المستحقة</label>
                            <input type="text" class="form-control" id="dueProfit" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">المبلغ المراد دفعه</label>
                            <input type="number" class="form-control" id="profitAmount" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">تاريخ الدفع</label>
                            <input type="date" class="form-control" id="profitDate" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">طريقة الدفع</label>
                            <select class="form-select" id="profitMethod">
                                <option value="cash">نقداً</option>
                                <option value="check">شيك</option>
                                <option value="transfer">حوالة بنكية</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ملاحظات</label>
                        <textarea class="form-control" id="profitNotes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" onclick="closeModal('payProfitModal')">إلغاء</button>
                <button class="btn btn-primary" onclick="savePayProfit()">تأكيد الدفع</button>
            </div>
        </div>
    </div>

    <!-- View Investor Modal -->
    <div class="modal-overlay" id="viewInvestorModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">معلومات المستثمر</h2>
                <div class="modal-close" onclick="closeModal('viewInvestorModal')">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="modal-body">
                <div class="modal-tabs">
                    <div class="modal-tab active" onclick="switchModalTab('investorDetails', 'viewInvestorModal')">المعلومات الشخصية</div>
                    <div class="modal-tab" onclick="switchModalTab('investorInvestments', 'viewInvestorModal')">الاستثمارات</div>
                    <div class="modal-tab" onclick="switchModalTab('investorOperations', 'viewInvestorModal')">العمليات</div>
                    <div class="modal-tab" onclick="switchModalTab('investorProfits', 'viewInvestorModal')">الأرباح</div>
                    <div class="modal-tab" onclick="switchModalTab('investorDocuments', 'viewInvestorModal')">المستندات</div>
                </div>
                <div class="modal-tab-content active" id="investorDetails">
                    <!-- Will be populated by JavaScript -->
                </div>
                <div class="modal-tab-content" id="investorInvestments">
                    <!-- Will be populated by JavaScript -->
                </div>
                <div class="modal-tab-content" id="investorOperations">
                    <!-- Will be populated by JavaScript -->
                </div>
                <div class="modal-tab-content" id="investorProfits">
                    <!-- Will be populated by JavaScript -->
                </div>
                <div class="modal-tab-content" id="investorDocuments">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" onclick="closeModal('viewInvestorModal')">إغلاق</button>
                <button class="btn btn-warning" onclick="editInvestor(currentInvestorId)">تعديل</button>
                <button class="btn btn-primary" onclick="openNewInvestmentModal(currentInvestorId)">استثمار جديد</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let investors = [];
        let investments = [];
        let operations = [];
        let settings = {
            monthlyProfitRate: 1.75, // Default 1.75% monthly
            companyName: 'شركة الاستثمار العراقية',
            minInvestment: 1000000,
            profitDistributionPeriod: 'monthly',
            profitDistributionDay: 1,
            earlyWithdrawalFee: 0.5,
            maxPartialWithdrawal: 50,
            currency: 'IQD',
            acceptedCurrencies: ['IQD', 'USD']
        };
        let currentInvestorId = null;

        // ============ Utility Functions ============
        
        // Generate a unique ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substring(2);
        }

        // Generate Operation ID
        function generateOperationId() {
            const year = new Date().getFullYear();
            const count = operations.length + 1;
            return `OP-${year}-${count.toString().padStart(3, '0')}`;
        }

        // Format number with commas
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Format date to local format
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-IQ');
        }

        // Calculate days difference between two dates
        function daysDifference(date1, date2) {
            const d1 = new Date(date1);
            const d2 = new Date(date2);
            const diffTime = Math.abs(d2 - d1);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        // Calculate monthly profit
        function calculateMonthlyProfit(amount) {
            return (amount * settings.monthlyProfitRate) / 100;
        }

        // Calculate profit for a specific date range
        function calculateProfit(amount, startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const months = (end.getFullYear() - start.getFullYear()) * 12 + end.getMonth() - start.getMonth();
            const days = end.getDate() - start.getDate();
            const totalDays = daysDifference(startDate, endDate);
            
            // Calculate monthly profit
            const monthlyProfit = calculateMonthlyProfit(amount);
            
            // If less than a month, calculate pro-rated profit
            if (months === 0) {
                const daysInMonth = new Date(end.getFullYear(), end.getMonth() + 1, 0).getDate();
                return (monthlyProfit * totalDays) / daysInMonth;
            } else {
                // Calculate complete months profit + remaining days
                const completeMonthsProfit = monthlyProfit * months;
                const daysInLastMonth = new Date(end.getFullYear(), end.getMonth() + 1, 0).getDate();
                const remainingDaysProfit = (monthlyProfit * days) / daysInLastMonth;
                
                return completeMonthsProfit + remainingDaysProfit;
            }
        }

        // Create a notification
        function createNotification(title, message, type) {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type}`;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.zIndex = '9999';
            notification.style.minWidth = '300px';
            notification.style.maxWidth = '500px';
            notification.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.2)';
            notification.style.transform = 'translateX(100%)';
            notification.style.opacity = '0';
            notification.style.transition = 'all 0.3s ease';
            
            notification.innerHTML = `
                <div class="alert-icon">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                </div>
                <div class="alert-content">
                    <div class="alert-title">${title}</div>
                    <div class="alert-text">${message}</div>
                </div>
                <div class="modal-close" style="position: absolute; top: 10px; left: 10px; cursor: pointer;" onclick="this.parentNode.remove()">
                    <i class="fas fa-times"></i>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
                notification.style.opacity = '1';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }

        // ============ UI Functions ============
        
        // Toggle sidebar on mobile
        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('active');
        }

        // Show specific page
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show the selected page
            document.getElementById(pageId).classList.add('active');
            
            // Mark the current menu item as active
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.querySelector(`.menu-item[href="#${pageId}"]`).classList.add('active');
            
            // Update the page content if needed
            if (pageId === 'dashboard') {
                updateDashboard();
            } else if (pageId === 'investors') {
                loadInvestors();
            } else if (pageId === 'investments') {
                loadInvestments();
            } else if (pageId === 'profits') {
                loadProfits();
            } else if (pageId === 'operations') {
                loadOperations();
            } else if (pageId === 'reports') {
                populateReportInvestors();
            } else if (pageId === 'settings') {
                loadSettings();
            }
        }

        // Toggle notification panel
        function toggleNotificationPanel() {
            document.getElementById('notificationPanel').classList.toggle('active');
        }

        // Open modal
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Switch tab in modal
        function switchModalTab(tabId, modalId) {
            // Hide all tabs
            document.querySelectorAll(`#${modalId} .modal-tab-content`).forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show the selected tab
            document.getElementById(tabId).classList.add('active');
            
            // Mark the current tab as active
            document.querySelectorAll(`#${modalId} .modal-tab`).forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`#${modalId} .modal-tab[onclick="switchModalTab('${tabId}', '${modalId}')"]`).classList.add('active');
        }

        // Switch analytics tab
        function switchAnalyticsTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.analytics-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show the selected tab
            document.getElementById(`analytics${tabId.charAt(0).toUpperCase() + tabId.slice(1)}`).classList.add('active');
            
            // Mark the current tab as active
            document.querySelectorAll('#analytics .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`#analytics .tab[onclick="switchAnalyticsTab('${tabId}')"]`).classList.add('active');
        }

        // Switch investments tab
        function switchInvestmentsTab(tabId) {
            // Mark the current tab as active
            document.querySelectorAll('#investments .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`#investments .tab[onclick="switchInvestmentsTab('${tabId}')"]`).classList.add('active');
            
            // Update table content based on selected tab
            if (tabId === 'active') {
                document.querySelector('#investments .table-title').textContent = 'الاستثمارات النشطة';
                loadInvestments('active');
            } else if (tabId === 'closed') {
                document.querySelector('#investments .table-title').textContent = 'الاستثمارات المغلقة';
                loadInvestments('closed');
            } else {
                document.querySelector('#investments .table-title').textContent = 'جميع الاستثمارات';
                loadInvestments('all');
            }
        }

        // Switch profits tab
        function switchProfitsTab(tabId) {
            // Mark the current tab as active
            document.querySelectorAll('#profits .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`#profits .tab[onclick="switchProfitsTab('${tabId}')"]`).classList.add('active');
        }

        // Switch operations tab
        function switchOperationsTab(tabId) {
            // Mark the current tab as active
            document.querySelectorAll('#operations .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`#operations .tab[onclick="switchOperationsTab('${tabId}')"]`).classList.add('active');
            
            // Update table content based on selected tab
            loadOperations(tabId);
        }

        // Switch reports tab
        function switchReportsTab(tabId) {
            // Mark the current tab as active
            document.querySelectorAll('#reports .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`#reports .tab[onclick="switchReportsTab('${tabId}')"]`).classList.add('active');
        }

        // Switch financial tab
        function switchFinancialTab(tabId) {
            // Mark the current tab as active
            document.querySelectorAll('#financial .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`#financial .tab[onclick="switchFinancialTab('${tabId}')"]`).classList.add('active');
        }

        // Switch calendar view
        function switchCalendarView(viewId) {
            // Mark the current tab as active
            document.querySelectorAll('#calendar .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`#calendar .tab[onclick="switchCalendarView('${viewId}')"]`).classList.add('active');
        }

        // Switch settings tab
        function switchSettingsTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.settings-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show the selected tab
            document.getElementById(`${tabId}Settings`).classList.add('active');
            
            // Mark the current tab as active
            document.querySelectorAll('#settings .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelector(`#settings .tab[onclick="switchSettingsTab('${tabId}')"]`).classList.add('active');
        }

        // Update days message when investment date changes
        function updateDaysMessage() {
            const dateInput = document.getElementById('investmentDate');
            const messageDiv = document.getElementById('daysMessage');
            
            if (!dateInput || !messageDiv || !dateInput.value) return;
            
            const selectedDate = new Date(dateInput.value);
            const today = new Date();
            
            // Reset time to compare only dates
            selectedDate.setHours(0, 0, 0, 0);
            today.setHours(0, 0, 0, 0);
            
            const diffDays = Math.floor((today - selectedDate) / (1000 * 60 * 60 * 24));
            
            if (diffDays > 0) {
                messageDiv.textContent = `تم اختيار تاريخ سابق (منذ ${diffDays} يوم)`;
                messageDiv.style.color = 'var(--warning-color)';
            } else if (diffDays < 0) {
                messageDiv.textContent = `تم اختيار تاريخ مستقبلي (بعد ${Math.abs(diffDays)} يوم)`;
                messageDiv.style.color = 'var(--info-color)';
            } else {
                messageDiv.textContent = 'تم اختيار تاريخ اليوم';
                messageDiv.style.color = 'var(--success-color)';
            }
        }

        // Update expected profit when investment amount changes
        function updateExpectedProfit() {
            const amountInput = document.getElementById('investmentAmount');
            const profitInput = document.getElementById('expectedProfit');
            
            if (!amountInput || !profitInput || !amountInput.value) {
                if (profitInput) profitInput.value = '';
                return;
            }
            
            const amount = parseFloat(amountInput.value);
            const monthlyProfit = calculateMonthlyProfit(amount);
            
            profitInput.value = formatNumber(monthlyProfit.toFixed(2)) + ' د.ع';
        }

        // Print table
        function printTable(tableId) {
            const table = document.getElementById(tableId);
            if (!table) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>طباعة</title>
                    <style>
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            direction: rtl;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 20px;
                        }
                        th, td {
                            border: 1px solid #ddd;
                            padding: 8px;
                            text-align: right;
                        }
                        th {
                            background-color: #f2f2f2;
                        }
                        h1 {
                            text-align: center;
                            margin-bottom: 20px;
                        }
                        .header {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 20px;
                        }
                        .date {
                            text-align: left;
                        }
                        .status {
                            padding: 5px 10px;
                            border-radius: 50px;
                            font-size: 0.75rem;
                            font-weight: 600;
                            text-align: center;
                            display: inline-block;
                        }
                        .status.active {
                            background: rgba(46, 204, 113, 0.1);
                            color: #2ecc71;
                        }
                        .status.pending {
                            background: rgba(243, 156, 18, 0.1);
                            color: #f39c12;
                        }
                        .status.closed {
                            background: rgba(231, 76, 60, 0.1);
                            color: #e74c3c;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h2>${settings.companyName}</h2>
                        <div class="date">تاريخ الطباعة: ${new Date().toLocaleDateString('ar-IQ')}</div>
                    </div>
                    <h1>${document.querySelector('.page.active .page-title').textContent}</h1>
                    ${table.outerHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
        }

        // Open add investor modal
        function openAddInvestorModal() {
            // Reset form
            document.getElementById('investorForm').reset();
            document.getElementById('initialInvestmentForm').reset();
            
            // Set default date to today
            document.getElementById('initialInvestmentDate').valueAsDate = new Date();
            
            openModal('addInvestorModal');
        }

        // Open new investment modal
        function openNewInvestmentModal(investorId = null) {
            // Reset form
            document.getElementById('newInvestmentForm').reset();
            
            // Set default date to today
            document.getElementById('investmentDate').valueAsDate = new Date();
            
            // Update days message
            updateDaysMessage();
            
            // Populate investor select
            populateInvestorSelect('investmentInvestor');
            
            // If investor ID is provided, select it
            if (investorId) {
                document.getElementById('investmentInvestor').value = investorId;
            }
            
            openModal('newInvestmentModal');
        }

        // Open withdraw modal
        function openWithdrawModal(investmentId = null) {
            // Reset form
            document.getElementById('withdrawForm').reset();
            
            // Set default date to today
            document.getElementById('withdrawDate').valueAsDate = new Date();
            
            // Populate investor select
            populateInvestorSelect('withdrawInvestor');
            
            // If investment ID is provided, find the investment and select investor and investment
            if (investmentId) {
                const investment = investments.find(inv => inv.id === investmentId);
                if (investment) {
                    document.getElementById('withdrawInvestor').value = investment.investorId;
                    // Populate investment select
                    populateInvestmentSelect();
                    // Wait for select to be populated
                    setTimeout(() => {
                        document.getElementById('withdrawInvestment').value = investmentId;
                        // Update available amount
                        updateAvailableAmount();
                    }, 100);
                }
            }
            
            openModal('withdrawModal');
        }

        // Open pay profit modal
        function openPayProfitModal(investorId = null) {
            // Reset form
            document.getElementById('payProfitForm').reset();
            
            // Set default date to today
            document.getElementById('profitDate').valueAsDate = new Date();
            
            // Hide custom period fields
            document.getElementById('customProfitPeriod').style.display = 'none';
            
            // Populate investor select
            populateInvestorSelect('profitInvestor');
            
            // If investor ID is provided, select it
            if (investorId) {
                document.getElementById('profitInvestor').value = investorId;
                // Update due profit
                updateDueProfit();
            }
            
            openModal('payProfitModal');
        }

        // View investor details
        function viewInvestor(id) {
            // Set current investor ID
            currentInvestorId = id;
            
            // Find investor
            const investor = investors.find(inv => inv.id === id);
            
            if (!investor) {
                createNotification('خطأ', 'المستثمر غير موجود', 'danger');
                return;
            }
            
            // Populate investor details tab
            const detailsTab = document.getElementById('investorDetails');
            
            // Calculate total investment for this investor
            const totalInvestment = investments
                .filter(inv => inv.investorId === investor.id && inv.status === 'active')
                .reduce((total, inv) => total + inv.amount, 0);
            
            // Calculate total profit for this investor
            const today = new Date();
            let totalProfit = 0;
            
            investments
                .filter(inv => inv.investorId === investor.id && inv.status === 'active')
                .forEach(inv => {
                    const profit = calculateProfit(inv.amount, inv.date, today);
                    totalProfit += profit;
                });
            
            detailsTab.innerHTML = `
                <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
                    <div style="width: 120px; height: 120px; background: var(--gray-200); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--gray-600); font-size: 3rem;">
                        <i class="fas fa-user"></i>
                    </div>
                    <div style="flex: 1; min-width: 250px;">
                        <h2 style="margin-bottom: 10px; color: var(--gray-800);">${investor.name}</h2>
                        <p style="margin-bottom: 5px;"><i class="fas fa-phone" style="width: 20px; color: var(--gray-600);"></i> ${investor.phone}</p>
                        <p style="margin-bottom: 5px;"><i class="fas fa-map-marker-alt" style="width: 20px; color: var(--gray-600);"></i> ${investor.address || 'غير محدد'}</p>
                        <p style="margin-bottom: 5px;"><i class="fas fa-id-card" style="width: 20px; color: var(--gray-600);"></i> ${investor.idCard || 'غير محدد'}</p>
                        <p style="margin-bottom: 5px;"><i class="fas fa-calendar-alt" style="width: 20px; color: var(--gray-600);"></i> تاريخ الانضمام: ${formatDate(investor.joinDate)}</p>
                    </div>
                    <div style="min-width: 200px;">
                        <div class="card" style="margin-bottom: 10px; border-right: 4px solid var(--primary-color);">
                            <div style="font-size: 0.9rem; color: var(--gray-600);">إجمالي الاستثمار</div>
                            <div style="font-size: 1.5rem; font-weight: 700;">${formatNumber(totalInvestment)} د.ع</div>
                        </div>
                        <div class="card" style="border-right: 4px solid var(--warning-color);">
                            <div style="font-size: 0.9rem; color: var(--gray-600);">إجمالي الأرباح</div>
                            <div style="font-size: 1.5rem; font-weight: 700;">${formatNumber(totalProfit.toFixed(2))} د.ع</div>
                        </div>
                    </div>
                </div>
                <div style="background: var(--gray-100); border-radius: var(--border-radius); padding: 15px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 10px; color: var(--gray-700);">معلومات إضافية</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <div style="font-size: 0.8rem; color: var(--gray-600);">البريد الإلكتروني</div>
                            <div>${investor.email || 'غير محدد'}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.8rem; color: var(--gray-600);">تاريخ الميلاد</div>
                            <div>${investor.birthdate ? formatDate(investor.birthdate) : 'غير محدد'}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.8rem; color: var(--gray-600);">المدينة</div>
                            <div>${investor.city || 'غير محدد'}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.8rem; color: var(--gray-600);">المهنة</div>
                            <div>${investor.occupation || 'غير محدد'}</div>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 style="margin-bottom: 10px; color: var(--gray-700);">ملاحظات</h3>
                    <p style="background: white; border-radius: var(--border-radius); padding: 15px; border: 1px solid var(--gray-200);">${investor.notes || 'لا توجد ملاحظات'}</p>
                </div>
            `;
            
        // Populate investor investments tab
            const investmentsTab = document.getElementById('investorInvestments');
            
            // Get investor investments
            const investorInvestments = investments.filter(inv => inv.investorId === investor.id);
            
            if (investorInvestments.length === 0) {
                investmentsTab.innerHTML = `
                    <div class="alert alert-info">
                        <div class="alert-icon">
                            <i class="fas fa-info"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">لا توجد استثمارات</div>
                            <div class="alert-text">لا توجد استثمارات لهذا المستثمر. يمكنك إضافة استثمار جديد من خلال الضغط على زر "استثمار جديد".</div>
                        </div>
                    </div>
                `;
            } else {
                investmentsTab.innerHTML = `
                    <div class="table-container" style="box-shadow: none; padding: 0;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>المبلغ</th>
                                    <th>تاريخ الاستثمار</th>
                                    <th>الربح الشهري</th>
                                    <th>إجمالي الأرباح</th>
                                    <th>الحالة</th>
                                    <th>إجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="investorInvestmentsBody"></tbody>
                        </table>
                    </div>
                `;
                
                const tbody = document.getElementById('investorInvestmentsBody');
                
                investorInvestments.forEach((investment, index) => {
                    const monthlyProfit = calculateMonthlyProfit(investment.amount);
                    const totalProfit = investment.status === 'active' ? 
                        calculateProfit(investment.amount, investment.date, today) : 0;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${formatNumber(investment.amount)} د.ع</td>
                        <td>${formatDate(investment.date)}</td>
                        <td>${formatNumber(monthlyProfit.toFixed(2))} د.ع</td>
                        <td>${formatNumber(totalProfit.toFixed(2))} د.ع</td>
                        <td><span class="status ${investment.status === 'active' ? 'active' : 'closed'}">${investment.status === 'active' ? 'نشط' : 'مغلق'}</span></td>
                        <td>
                            <button class="btn btn-info btn-icon action-btn" onclick="viewInvestment('${investment.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${investment.status === 'active' ? `
                                <button class="btn btn-warning btn-icon action-btn" onclick="openWithdrawModal('${investment.id}')">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <button class="btn btn-success btn-icon action-btn" onclick="openPayProfitModal('${investor.id}')">
                                    <i class="fas fa-money-bill"></i>
                                </button>
                            ` : ''}
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
            }
            
            // Populate investor operations tab
            const operationsTab = document.getElementById('investorOperations');
            
            // Get investor operations
            const investorOperations = operations.filter(op => op.investorId === investor.id);
            
            if (investorOperations.length === 0) {
                operationsTab.innerHTML = `
                    <div class="alert alert-info">
                        <div class="alert-icon">
                            <i class="fas fa-info"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">لا توجد عمليات</div>
                            <div class="alert-text">لا توجد عمليات لهذا المستثمر.</div>
                        </div>
                    </div>
                `;
            } else {
                operationsTab.innerHTML = `
                    <div class="table-container" style="box-shadow: none; padding: 0;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>رقم العملية</th>
                                    <th>نوع العملية</th>
                                    <th>المبلغ</th>
                                    <th>التاريخ</th>
                                    <th>الحالة</th>
                                    <th>ملاحظات</th>
                                </tr>
                            </thead>
                            <tbody id="investorOperationsBody"></tbody>
                        </table>
                    </div>
                `;
                
                const tbody = document.getElementById('investorOperationsBody');
                
                // Sort operations by date (newest first)
                const sortedOperations = [...investorOperations].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                sortedOperations.forEach((operation) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${operation.id}</td>
                        <td>${getOperationTypeName(operation.type)}</td>
                        <td>${formatNumber(operation.amount)} د.ع</td>
                        <td>${formatDate(operation.date)}</td>
                        <td><span class="status ${operation.status === 'pending' ? 'pending' : 'active'}">${operation.status === 'pending' ? 'معلق' : 'مكتمل'}</span></td>
                        <td>${operation.notes || '-'}</td>
                    `;
                    
                    tbody.appendChild(row);
                });
            }
            
            // Populate investor profits tab
            const profitsTab = document.getElementById('investorProfits');
            
            // Get active investments for this investor
            const activeInvestments = investments.filter(inv => inv.investorId === investor.id && inv.status === 'active');
            
            if (activeInvestments.length === 0) {
                profitsTab.innerHTML = `
                    <div class="alert alert-info">
                        <div class="alert-icon">
                            <i class="fas fa-info"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">لا توجد استثمارات نشطة</div>
                            <div class="alert-text">لا توجد استثمارات نشطة لهذا المستثمر لحساب الأرباح.</div>
                        </div>
                    </div>
                `;
            } else {
                // Get profit payment operations
                const profitPayments = operations.filter(op => op.investorId === investor.id && op.type === 'profit');
                
                // Calculate total profit paid
                const totalProfitPaid = profitPayments.reduce((total, op) => total + op.amount, 0);
                
                profitsTab.innerHTML = `
                    <div class="dashboard-cards" style="margin-bottom: 20px;">
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">إجمالي الأرباح</div>
                                    <div class="card-value">${formatNumber(totalProfit.toFixed(2))} د.ع</div>
                                </div>
                                <div class="card-icon primary">
                                    <i class="fas fa-hand-holding-usd"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">الأرباح المدفوعة</div>
                                    <div class="card-value">${formatNumber(totalProfitPaid.toFixed(2))} د.ع</div>
                                </div>
                                <div class="card-icon success">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">الأرباح المستحقة</div>
                                    <div class="card-value">${formatNumber((totalProfit - totalProfitPaid).toFixed(2))} د.ع</div>
                                </div>
                                <div class="card-icon warning">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container" style="box-shadow: none; padding: 0;">
                        <div class="table-header">
                            <div class="table-title">سجل دفع الأرباح</div>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>رقم العملية</th>
                                    <th>المبلغ</th>
                                    <th>التاريخ</th>
                                    <th>ملاحظات</th>
                                </tr>
                            </thead>
                            <tbody id="investorProfitsBody"></tbody>
                        </table>
                    </div>
                `;
                
                const tbody = document.getElementById('investorProfitsBody');
                
                if (profitPayments.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td colspan="4" style="text-align: center;">لا توجد عمليات دفع أرباح</td>
                    `;
                    tbody.appendChild(row);
                } else {
                    // Sort profit payments by date (newest first)
                    const sortedPayments = [...profitPayments].sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    sortedPayments.forEach((payment) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${payment.id}</td>
                            <td>${formatNumber(payment.amount)} د.ع</td>
                            <td>${formatDate(payment.date)}</td>
                            <td>${payment.notes || '-'}</td>
                        `;
                        
                        tbody.appendChild(row);
                    });
                }
            }
            
            // Populate investor documents tab
            const documentsTab = document.getElementById('investorDocuments');
            
            documentsTab.innerHTML = `
                <div class="alert alert-info">
                    <div class="alert-icon">
                        <i class="fas fa-info"></i>
                    </div>
                    <div class="alert-content">
                        <div class="alert-title">المستندات</div>
                        <div class="alert-text">يمكنك إدارة مستندات المستثمر من هنا.</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div class="card" style="padding: 15px; text-align: center;">
                        <div style="font-size: 3rem; color: var(--primary-color); margin-bottom: 10px;">
                            <i class="fas fa-id-card"></i>
                        </div>
                        <div style="font-weight: 600; margin-bottom: 5px;">صورة البطاقة الشخصية</div>
                        <button class="btn btn-sm btn-primary" style="margin-top: 10px;" onclick="uploadDocument('${investor.id}', 'idCard')">
                            <i class="fas fa-upload"></i> تحميل
                        </button>
                    </div>
                    <div class="card" style="padding: 15px; text-align: center;">
                        <div style="font-size: 3rem; color: var(--primary-color); margin-bottom: 10px;">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <div style="font-weight: 600; margin-bottom: 5px;">عقد الاستثمار</div>
                        <button class="btn btn-sm btn-primary" style="margin-top: 10px;" onclick="uploadDocument('${investor.id}', 'contract')">
                            <i class="fas fa-upload"></i> تحميل
                        </button>
                    </div>
                    <div class="card" style="padding: 15px; text-align: center;">
                        <div style="font-size: 3rem; color: var(--primary-color); margin-bottom: 10px;">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div style="font-weight: 600; margin-bottom: 5px;">مستندات إضافية</div>
                        <button class="btn btn-sm btn-primary" style="margin-top: 10px;" onclick="uploadDocument('${investor.id}', 'other')">
                            <i class="fas fa-upload"></i> تحميل
                        </button>
                    </div>
                </div>
            `;
            
            openModal('viewInvestorModal');
        }

        // View investment details
        function viewInvestment(id) {
            // Find investment
            const investment = investments.find(inv => inv.id === id);
            
            if (!investment) {
                createNotification('خطأ', 'الاستثمار غير موجود', 'danger');
                return;
            }
            
            // Find investor
            const investor = investors.find(inv => inv.id === investment.investorId);
            
            if (!investor) {
                createNotification('خطأ', 'المستثمر غير موجود', 'danger');
                return;
            }
            
            // Calculate monthly profit
            const monthlyProfit = calculateMonthlyProfit(investment.amount);
            
            // Calculate total profit
            const today = new Date();
            const totalProfit = investment.status === 'active' ? 
                calculateProfit(investment.amount, investment.date, today) : 0;
            
            // Create investment details popup
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.id = 'viewInvestmentModal';
            
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h2 class="modal-title">تفاصيل الاستثمار</h2>
                        <div class="modal-close" onclick="document.getElementById('viewInvestmentModal').remove()">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="form-container" style="box-shadow: none; padding: 0; margin-bottom: 20px;">
                            <div class="dashboard-cards">
                                <div class="card">
                                    <div class="card-header">
                                        <div>
                                            <div class="card-title">المبلغ</div>
                                            <div class="card-value">${formatNumber(investment.amount)} د.ع</div>
                                        </div>
                                        <div class="card-icon primary">
                                            <i class="fas fa-money-bill-wave"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        <div>
                                            <div class="card-title">الربح الشهري</div>
                                            <div class="card-value">${formatNumber(monthlyProfit.toFixed(2))} د.ع</div>
                                        </div>
                                        <div class="card-icon success">
                                            <i class="fas fa-percentage"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        <div>
                                            <div class="card-title">إجمالي الأرباح</div>
                                            <div class="card-value">${formatNumber(totalProfit.toFixed(2))} د.ع</div>
                                        </div>
                                        <div class="card-icon warning">
                                            <i class="fas fa-hand-holding-usd"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-container" style="box-shadow: none; padding: 0; margin-bottom: 20px;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">المستثمر</label>
                                    <input type="text" class="form-control" value="${investor.name}" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">تاريخ الاستثمار</label>
                                    <input type="text" class="form-control" value="${formatDate(investment.date)}" readonly>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">الحالة</label>
                                    <input type="text" class="form-control" value="${investment.status === 'active' ? 'نشط' : 'مغلق'}" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">مدة الاستثمار</label>
                                    <input type="text" class="form-control" value="${daysDifference(investment.date, today)} يوم" readonly>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">نسبة الربح الشهرية</label>
                                    <input type="text" class="form-control" value="${settings.monthlyProfitRate}%" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">طريقة الدفع</label>
                                    <input type="text" class="form-control" value="${investment.method || 'نقداً'}" readonly>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ملاحظات</label>
                                <textarea class="form-control" rows="3" readonly>${investment.notes || 'لا توجد ملاحظات'}</textarea>
                            </div>
                        </div>
                        
                        <div class="table-container" style="box-shadow: none; padding: 0;">
                            <div class="table-header">
                                <div class="table-title">العمليات المرتبطة</div>
                            </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>رقم العملية</th>
                                        <th>نوع العملية</th>
                                        <th>المبلغ</th>
                                        <th>التاريخ</th>
                                        <th>الحالة</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${operations
                                        .filter(op => op.investmentId === investment.id)
                                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                                        .map(op => `
                                            <tr>
                                                <td>${op.id}</td>
                                                <td>${getOperationTypeName(op.type)}</td>
                                                <td>${formatNumber(op.amount)} د.ع</td>
                                                <td>${formatDate(op.date)}</td>
                                                <td><span class="status ${op.status === 'pending' ? 'pending' : 'active'}">${op.status === 'pending' ? 'معلق' : 'مكتمل'}</span></td>
                                            </tr>
                                        `).join('') || `<tr><td colspan="5" style="text-align: center;">لا توجد عمليات مرتبطة</td></tr>`
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" onclick="document.getElementById('viewInvestmentModal').remove()">إغلاق</button>
                        ${investment.status === 'active' ? `
                            <button class="btn btn-warning" onclick="document.getElementById('viewInvestmentModal').remove(); openWithdrawModal('${investment.id}')">
                                <i class="fas fa-minus"></i> سحب
                            </button>
                            <button class="btn btn-primary" onclick="document.getElementById('viewInvestmentModal').remove(); openPayProfitModal('${investor.id}')">
                                <i class="fas fa-money-bill"></i> دفع أرباح
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // View operation details
        function viewOperation(id) {
            // Find operation
            const operation = operations.find(op => op.id === id);
            
            if (!operation) {
                createNotification('خطأ', 'العملية غير موجودة', 'danger');
                return;
            }
            
            // Find investor
            const investor = investors.find(inv => inv.id === operation.investorId);
            
            if (!investor) {
                createNotification('خطأ', 'المستثمر غير موجود', 'danger');
                return;
            }
            
            // Find investment if applicable
            const investment = operation.investmentId ? 
                investments.find(inv => inv.id === operation.investmentId) : null;
            
            // Create operation details popup
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.id = 'viewOperationModal';
            
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h2 class="modal-title">تفاصيل العملية</h2>
                        <div class="modal-close" onclick="document.getElementById('viewOperationModal').remove()">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-${operation.status === 'pending' ? 'warning' : 'success'}">
                            <div class="alert-icon">
                                <i class="fas fa-${operation.status === 'pending' ? 'exclamation-triangle' : 'check-circle'}"></i>
                            </div>
                            <div class="alert-content">
                                <div class="alert-title">حالة العملية: ${operation.status === 'pending' ? 'معلقة' : 'مكتملة'}</div>
                                <div class="alert-text">${operation.status === 'pending' ? 'هذه العملية معلقة وتحتاج إلى موافقة.' : 'تم تنفيذ هذه العملية بنجاح.'}</div>
                            </div>
                        </div>
                        
                        <div class="form-container" style="box-shadow: none; padding: 0; margin-bottom: 20px;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">رقم العملية</label>
                                    <input type="text" class="form-control" value="${operation.id}" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">نوع العملية</label>
                                    <input type="text" class="form-control" value="${getOperationTypeName(operation.type)}" readonly>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">المستثمر</label>
                                    <input type="text" class="form-control" value="${investor.name}" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">المبلغ</label>
                                    <input type="text" class="form-control" value="${formatNumber(operation.amount)} د.ع" readonly>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">تاريخ العملية</label>
                                    <input type="text" class="form-control" value="${formatDate(operation.date)}" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">وقت العملية</label>
                                    <input type="text" class="form-control" value="${new Date(operation.date).toLocaleTimeString('ar-IQ')}" readonly>
                                </div>
                            </div>
                            ${investment ? `
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">الاستثمار المرتبط</label>
                                        <input type="text" class="form-control" value="${formatNumber(investment.amount)} د.ع - ${formatDate(investment.date)}" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">حالة الاستثمار</label>
                                        <input type="text" class="form-control" value="${investment.status === 'active' ? 'نشط' : 'مغلق'}" readonly>
                                    </div>
                                </div>
                            ` : ''}
                            <div class="form-group">
                                <label class="form-label">ملاحظات</label>
                                <textarea class="form-control" rows="3" readonly>${operation.notes || 'لا توجد ملاحظات'}</textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" onclick="document.getElementById('viewOperationModal').remove()">إغلاق</button>
                        ${operation.status === 'pending' ? `
                            <button class="btn btn-success" onclick="approveOperation('${operation.id}')">
                                <i class="fas fa-check"></i> موافقة
                            </button>
                            <button class="btn btn-danger" onclick="rejectOperation('${operation.id}')">
                                <i class="fas fa-times"></i> رفض
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Populate investor select
        function populateInvestorSelect(selectId) {
            const select = document.getElementById(selectId);
            
            if (!select) return;
            
            // Clear previous options
            select.innerHTML = '<option value="">اختر المستثمر</option>';
            
            // Add investor options
            investors.forEach(investor => {
                const option = document.createElement('option');
                option.value = investor.id;
                option.textContent = investor.name;
                select.appendChild(option);
            });
        }

        // Populate investment select
        function populateInvestmentSelect() {
            const investorId = document.getElementById('withdrawInvestor').value;
            const investmentSelect = document.getElementById('withdrawInvestment');
            
            // Clear previous options
            investmentSelect.innerHTML = '<option value="">اختر الاستثمار</option>';
            
            if (!investorId) return;
            
            // Find active investments for the selected investor
            const activeInvestments = investments.filter(
                inv => inv.investorId === investorId && inv.status === 'active'
            );
            
            activeInvestments.forEach(inv => {
                const option = document.createElement('option');
                option.value = inv.id;
                option.textContent = `${formatNumber(inv.amount)} د.ع - ${formatDate(inv.date)}`;
                investmentSelect.appendChild(option);
            });
        }

        // Update available amount
        function updateAvailableAmount() {
            const investmentId = document.getElementById('withdrawInvestment').value;
            const availableInput = document.getElementById('availableAmount');
            
            if (!investmentId || !availableInput) return;
            
            const investment = investments.find(inv => inv.id === investmentId);
            if (investment) {
                availableInput.value = formatNumber(investment.amount) + ' د.ع';
            }
        }

        // Update due profit
        function updateDueProfit() {
            const investorId = document.getElementById('profitInvestor').value;
            const dueProfitInput = document.getElementById('dueProfit');
            
            if (!investorId || !dueProfitInput) return;
            
            // Calculate total profit for the investor
            let totalProfit = 0;
            
            // Find active investments for the selected investor
            const activeInvestments = investments.filter(
                inv => inv.investorId === investorId && inv.status === 'active'
            );
            
            const today = new Date();
            
            activeInvestments.forEach(inv => {
                const profit = calculateProfit(inv.amount, inv.date, today);
                totalProfit += profit;
            });
            
            // Get total profit paid
            const profitPaid = operations
                .filter(op => op.investorId === investorId && op.type === 'profit')
                .reduce((total, op) => total + op.amount, 0);
            
            // Calculate due profit
            const dueProfit = Math.max(0, totalProfit - profitPaid);
            
            dueProfitInput.value = formatNumber(dueProfit.toFixed(2)) + ' د.ع';
            
            // Update profit amount
            const profitAmountInput = document.getElementById('profitAmount');
            if (profitAmountInput) {
                profitAmountInput.value = dueProfit.toFixed(0);
            }
        }

        // Toggle custom profit period
        function toggleCustomProfitPeriod() {
            const periodSelect = document.getElementById('profitPeriod');
            const customPeriod = document.getElementById('customProfitPeriod');
            
            if (!periodSelect || !customPeriod) return;
            
            if (periodSelect.value === 'custom') {
                customPeriod.style.display = 'grid';
            } else {
                customPeriod.style.display = 'none';
            }
        }

        // Get operation type name
        function getOperationTypeName(type) {
            switch (type) {
                case 'investment':
                    return 'استثمار جديد';
                case 'withdrawal':
                    return 'سحب';
                case 'profit':
                    return 'دفع أرباح';
                default:
                    return type;
            }
        }

        // ============ CRUD Operations ============
        
        // Save investor
        function saveInvestor() {
            // Get form values
            const name = document.getElementById('investorName').value;
            const phone = document.getElementById('investorPhone').value;
            const email = document.getElementById('investorEmail').value;
            const birthdate = document.getElementById('investorBirthdate').value;
            const address = document.getElementById('investorAddress').value;
            const city = document.getElementById('investorCity').value;
            const idCard = document.getElementById('investorIdCard').value;
            const idCardDate = document.getElementById('investorIdCardDate').value;
            const occupation = document.getElementById('investorOccupation').value;
            const notes = document.getElementById('investorNotes').value;
            
            // Validate required fields
            if (!name || !phone || !address || !city || !idCard) {
                createNotification('خطأ', 'يرجى ملء جميع الحقول المطلوبة', 'danger');
                return;
            }
            
            // Create new investor
            const newInvestor = {
                id: generateId(),
                name,
                phone,
                email,
                birthdate,
                address,
                city,
                idCard,
                idCardDate,
                occupation,
                notes,
                joinDate: new Date().toISOString()
            };
            
            // Add investor to array
            investors.push(newInvestor);
            
            // Check if there's an initial investment
            const initialAmount = document.getElementById('initialInvestmentAmount').value;
            const initialDate = document.getElementById('initialInvestmentDate').value;
            
            if (initialAmount && initialDate) {
                const amount = parseFloat(initialAmount);
                const method = document.getElementById('initialInvestmentMethod').value;
                const reference = document.getElementById('initialInvestmentReference').value;
                const investmentNotes = document.getElementById('initialInvestmentNotes').value;
                
                // Create new investment
                const newInvestment = {
                    id: generateId(),
                    investorId: newInvestor.id,
                    amount,
                    date: initialDate,
                    method,
                    reference,
                    notes: investmentNotes,
                    status: 'active'
                };
                
                // Add investment to array
                investments.push(newInvestment);
                
                // Create operation
                const newOperation = {
                    id: generateOperationId(),
                    investorId: newInvestor.id,
                    type: 'investment',
                    amount,
                    date: new Date().toISOString(),
                    investmentId: newInvestment.id,
                    notes: 'استثمار جديد',
                    status: 'active'
                };
                
                // Add operation to array
                operations.push(newOperation);
            }
            
            // Save data
            saveData();
            
            // Close modal
            closeModal('addInvestorModal');
            
            // Refresh investors table
            loadInvestors();
            
            // Show success notification
            createNotification('نجاح', 'تم إضافة المستثمر بنجاح', 'success');
        }

        // Save investment
        function saveInvestment() {
            // Get form values
            const investorId = document.getElementById('investmentInvestor').value;
            const amount = parseFloat(document.getElementById('investmentAmount').value);
            const date = document.getElementById('investmentDate').value;
            const method = document.getElementById('investmentMethod').value;
            const reference = document.getElementById('investmentReference').value;
            const notes = document.getElementById('investmentNotes').value;
            
            // Validate required fields
            if (!investorId || !amount || !date) {
                createNotification('خطأ', 'يرجى ملء جميع الحقول المطلوبة', 'danger');
                return;
            }
            
            // Validate amount
            if (amount <= 0 || amount < settings.minInvestment) {
                createNotification('خطأ', `المبلغ يجب أن يكون أكبر من ${formatNumber(settings.minInvestment)} د.ع`, 'danger');
                return;
            }
            
            // Create new investment
            const newInvestment = {
                id: generateId(),
                investorId,
                amount,
                date,
                method,
                reference,
                notes,
                status: 'active'
            };
            
            // Add investment to array
            investments.push(newInvestment);
            
            // Create operation
            const newOperation = {
                id: generateOperationId(),
                investorId,
                type: 'investment',
                amount,
                date: new Date().toISOString(),
                investmentId: newInvestment.id,
                notes: notes || 'استثمار جديد',
                status: 'active'
            };
            
            // Add operation to array
            operations.push(newOperation);
            
            // Save data
            saveData();
            
            // Close modal
            closeModal('newInvestmentModal');
            
            // Refresh investments table
            loadInvestments();
            
            // Show success notification
            createNotification('نجاح', 'تم إضافة الاستثمار بنجاح', 'success');
        }

        // Save withdrawal
        function saveWithdrawal() {
            // Get form values
            const investmentId = document.getElementById('withdrawInvestment').value;
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const date = document.getElementById('withdrawDate').value;
            const method = document.getElementById('withdrawMethod').value;
            const notes = document.getElementById('withdrawNotes').value;
            
            // Validate required fields
            if (!investmentId || !amount || !date) {
                createNotification('خطأ', 'يرجى ملء جميع الحقول المطلوبة', 'danger');
                return;
            }
            
            // Find investment
            const investment = investments.find(inv => inv.id === investmentId);
            
            if (!investment) {
                createNotification('خطأ', 'الاستثمار غير موجود', 'danger');
                return;
            }
            
            // Validate amount
            if (amount <= 0 || amount > investment.amount) {
                createNotification('خطأ', 'المبلغ غير صحيح', 'danger');
                return;
            }
            
            // Check if partial withdrawal is allowed
            if (amount < investment.amount && (amount / investment.amount) * 100 > settings.maxPartialWithdrawal) {
                createNotification('خطأ', `الحد الأقصى للسحب الجزئي هو ${settings.maxPartialWithdrawal}% من المبلغ`, 'danger');
                return;
            }
            
            // Create operation
            const newOperation = {
                id: generateOperationId(),
                investorId: investment.investorId,
                type: 'withdrawal',
                amount,
                date: new Date().toISOString(),
                investmentId,
                notes: notes || 'سحب',
                status: 'pending'
            };
            
            // Add operation to array
            operations.push(newOperation);
            
            // Save data
            saveData();
            
            // Close modal
            closeModal('withdrawModal');
            
            // Refresh operations table
            loadOperations();
            
            // Show success notification
            createNotification('نجاح', 'تم تسجيل طلب السحب بنجاح', 'success');
        }

        // Save pay profit
        function savePayProfit() {
            // Get form values
            const investorId = document.getElementById('profitInvestor').value;
            const amount = parseFloat(document.getElementById('profitAmount').value);
            const date = document.getElementById('profitDate').value;
            const method = document.getElementById('profitMethod').value;
            const notes = document.getElementById('profitNotes').value;
            
            // Validate required fields
            if (!investorId || !amount || !date) {
                createNotification('خطأ', 'يرجى ملء جميع الحقول المطلوبة', 'danger');
                return;
            }
            
            // Validate amount
            if (amount <= 0) {
                createNotification('خطأ', 'المبلغ غير صحيح', 'danger');
                return;
            }
            
            // Create operation
            const newOperation = {
                id: generateOperationId(),
                investorId,
                type: 'profit',
                amount,
                date: new Date().toISOString(),
                notes: notes || 'دفع أرباح',
                status: 'active'
            };
            
            // Add operation to array
            operations.push(newOperation);
            
            // Save data
            saveData();
            
            // Close modal
            closeModal('payProfitModal');
            
            // Refresh operations table
            loadOperations();
            
            // Show success notification
            createNotification('نجاح', 'تم تسجيل دفع الأرباح بنجاح', 'success');
        }

        // Approve operation
        function approveOperation(id) {
            // Find operation
            const operation = operations.find(op => op.id === id);
            
            if (!operation) {
                createNotification('خطأ', 'العملية غير موجودة', 'danger');
                return;
            }
            
            // Update operation status
            operation.status = 'active';
            
            // If withdrawal operation, update investment
            if (operation.type === 'withdrawal' && operation.investmentId) {
                const investment = investments.find(inv => inv.id === operation.investmentId);
                
                if (investment) {
                    // Update investment amount or status
                    if (operation.amount === investment.amount) {
                        investment.status = 'closed';
                    } else {
                        investment.amount -= operation.amount;
                    }
                }
            }
            
            // Save data
            saveData();
            
            // Close operation modal if open
            const operationModal = document.getElementById('viewOperationModal');
            if (operationModal) {
                operationModal.remove();
            }
            
            // Refresh operations table
            loadOperations();
            
            // Show success notification
            createNotification('نجاح', 'تمت الموافقة على العملية بنجاح', 'success');
        }

        // Reject operation
        function rejectOperation(id) {
            // Find operation
            const operation = operations.find(op => op.id === id);
            
            if (!operation) {
                createNotification('خطأ', 'العملية غير موجودة', 'danger');
                return;
            }
            
            // Remove operation
            operations = operations.filter(op => op.id !== id);
            
            // Save data
            saveData();
            
            // Close operation modal if open
            const operationModal = document.getElementById('viewOperationModal');
            if (operationModal) {
                operationModal.remove();
            }
            
            // Refresh operations table
            loadOperations();
            
            // Show success notification
            createNotification('نجاح', 'تم رفض العملية بنجاح', 'danger');
        }

        // Edit investor
        function editInvestor(id) {
            currentInvestorId = id;
            
            // Find investor
            const investor = investors.find(inv => inv.id === id);
            
            if (!investor) {
                createNotification('خطأ', 'المستثمر غير موجود', 'danger');
                return;
            }
            
            // Close view modal if open
            const viewModal = document.getElementById('viewInvestorModal');
            if (viewModal) {
                viewModal.remove();
            }
            
            // Create edit investor modal
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.id = 'editInvestorModal';
            
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h2 class="modal-title">تعديل بيانات المستثمر</h2>
                        <div class="modal-close" onclick="document.getElementById('editInvestorModal').remove()">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                    <div class="modal-body">
                        <form id="editInvestorForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">الاسم الكامل</label>
                                    <input type="text" class="form-control" id="editInvestorName" value="${investor.name}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">رقم الهاتف</label>
                                    <input type="text" class="form-control" id="editInvestorPhone" value="${investor.phone}" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">البريد الإلكتروني</label>
                                    <input type="email" class="form-control" id="editInvestorEmail" value="${investor.email || ''}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">تاريخ الميلاد</label>
                                    <input type="date" class="form-control" id="editInvestorBirthdate" value="${investor.birthdate || ''}">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">العنوان</label>
                                    <input type="text" class="form-control" id="editInvestorAddress" value="${investor.address || ''}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">المدينة</label>
                                    <input type="text" class="form-control" id="editInvestorCity" value="${investor.city || ''}" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">رقم البطاقة الشخصية</label>
                                    <input type="text" class="form-control" id="editInvestorIdCard" value="${investor.idCard || ''}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">تاريخ إصدار البطاقة</label>
                                    <input type="date" class="form-control" id="editInvestorIdCardDate" value="${investor.idCardDate || ''}">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">المهنة</label>
                                    <input type="text" class="form-control" id="editInvestorOccupation" value="${investor.occupation || ''}">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ملاحظات</label>
                                    <textarea class="form-control" id="editInvestorNotes" rows="3">${investor.notes || ''}</textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" onclick="document.getElementById('editInvestorModal').remove()">إلغاء</button>
                        <button class="btn btn-primary" onclick="updateInvestor()">حفظ التغييرات</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Update investor
        function updateInvestor() {
            // Find investor
            const investor = investors.find(inv => inv.id === currentInvestorId);
            
            if (!investor) {
                createNotification('خطأ', 'المستثمر غير موجود', 'danger');
                return;
            }
            
            // Get form values
            const name = document.getElementById('editInvestorName').value;
            const phone = document.getElementById('editInvestorPhone').value;
            const email = document.getElementById('editInvestorEmail').value;
            const birthdate = document.getElementById('editInvestorBirthdate').value;
            const address = document.getElementById('editInvestorAddress').value;
            const city = document.getElementById('editInvestorCity').value;
            const idCard = document.getElementById('editInvestorIdCard').value;
            const idCardDate = document.getElementById('editInvestorIdCardDate').value;
            const occupation = document.getElementById('editInvestorOccupation').value;
            const notes = document.getElementById('editInvestorNotes').value;
            
            // Validate required fields
            if (!name || !phone || !address || !city || !idCard) {
                createNotification('خطأ', 'يرجى ملء جميع الحقول المطلوبة', 'danger');
                return;
            }
            
            // Update investor
            investor.name = name;
            investor.phone = phone;
            investor.email = email;
            investor.birthdate = birthdate;
            investor.address = address;
            investor.city = city;
            investor.idCard = idCard;
            investor.idCardDate = idCardDate;
            investor.occupation = occupation;
            investor.notes = notes;
            
            // Save data
            saveData();
            
            // Close modal
            document.getElementById('editInvestorModal').remove();
            
            // Refresh investors table
            loadInvestors();
            
            // Show success notification
            createNotification('نجاح', 'تم تحديث بيانات المستثمر بنجاح', 'success');
        }

        // Delete investor
        function deleteInvestor(id) {
            // Find investor
            const investor = investors.find(inv => inv.id === id);
            
            if (!investor) {
                createNotification('خطأ', 'المستثمر غير موجود', 'danger');
                return;
            }
            
            // Check if investor has active investments
            const hasActiveInvestments = investments.some(
                inv => inv.investorId === id && inv.status === 'active'
            );
            
            if (hasActiveInvestments) {
                createNotification('خطأ', 'لا يمكن حذف المستثمر لأن لديه استثمارات نشطة', 'danger');
                return;
            }
            
            // Confirm deletion
            if (!confirm('هل أنت متأكد من حذف المستثمر؟')) {
                return;
            }
            
            // Remove investor
            investors = investors.filter(inv => inv.id !== id);
            
            // Remove investor investments
            investments = investments.filter(inv => inv.investorId !== id);
            
            // Remove investor operations
            operations = operations.filter(op => op.investorId !== id);
            
            // Save data
            saveData();
            
            // Refresh investors table
            loadInvestors();
            
            // Show success notification
            createNotification('نجاح', 'تم حذف المستثمر بنجاح', 'danger');
        }

        // ============ Data Loading Functions ============
        
        // Load data from localStorage
        function loadData() {
            try {
                const storedInvestors = localStorage.getItem('investors');
                const storedInvestments = localStorage.getItem('investments');
                const storedOperations = localStorage.getItem('operations');
                const storedSettings = localStorage.getItem('settings');
                
                if (storedInvestors) {
                    investors = JSON.parse(storedInvestors);
                }
                
                if (storedInvestments) {
                    investments = JSON.parse(storedInvestments);
                }
                
                if (storedOperations) {
                    operations = JSON.parse(storedOperations);
                }
                
                if (storedSettings) {
                    settings = JSON.parse(storedSettings);
                }
            } catch (error) {
                console.error('Error loading data:', error);
                createNotification('خطأ', 'حدث خطأ أثناء تحميل البيانات', 'danger');
            }
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('investors', JSON.stringify(investors));
                localStorage.setItem('investments', JSON.stringify(investments));
                localStorage.setItem('operations', JSON.stringify(operations));
                localStorage.setItem('settings', JSON.stringify(settings));
            } catch (error) {
                console.error('Error saving data:', error);
                createNotification('خطأ', 'حدث خطأ أثناء حفظ البيانات', 'danger');
            }
        }

        // Update dashboard
        function updateDashboard() {
            // Calculate total investors
            document.getElementById('totalInvestors').textContent = investors.length;
            
            // Calculate total investments
            const totalInvestmentAmount = investments
                .filter(inv => inv.status === 'active')
                .reduce((total, inv) => total + inv.amount, 0);
            
            document.getElementById('totalInvestments').textContent = formatNumber(totalInvestmentAmount) + ' د.ع';
            
            // Calculate total profits
            const today = new Date();
            let totalProfits = 0;
            
            investments
                .filter(inv => inv.status === 'active')
                .forEach(inv => {
                    const profit = calculateProfit(inv.amount, inv.date, today);
                    totalProfits += profit;
                });
            
            document.getElementById('totalProfits').textContent = formatNumber(totalProfits.toFixed(2)) + ' د.ع';
            
            // Calculate total transactions
            document.getElementById('totalTransactions').textContent = operations.length;
            
            // Load recent transactions
            const recentOps = [...operations].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
            
            const tbody = document.getElementById('recentTransactionsBody');
            if (tbody) {
                tbody.innerHTML = '';
                
                recentOps.forEach(op => {
                    const investor = investors.find(inv => inv.id === op.investorId);
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${investor ? investor.name : 'غير معروف'}</td>
                        <td>${getOperationTypeName(op.type)}</td>
                        <td>${formatNumber(op.amount)} د.ع</td>
                        <td>${formatDate(op.date)}</td>
                        <td><span class="status ${op.status === 'pending' ? 'pending' : 'active'}">${op.status === 'pending' ? 'معلق' : 'مكتمل'}</span></td>
                    `;
                    
                    tbody.appendChild(row);
                });
            }
            
            // Load recent investors
            const recentInvestors = [...investors].sort((a, b) => new Date(b.joinDate) - new Date(a.joinDate)).slice(0, 4);
            
            const investorsBody = document.getElementById('recentInvestorsBody');
            if (investorsBody) {
                investorsBody.innerHTML = '';
                
                recentInvestors.forEach(investor => {
                    // Get latest investment for this investor
                    const latestInvestment = [...investments]
                        .filter(inv => inv.investorId === investor.id)
                        .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                    
                    if (latestInvestment) {
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${investor.name}</td>
                            <td>${formatNumber(latestInvestment.amount)} د.ع</td>
                            <td>${formatDate(latestInvestment.date)}</td>
                        `;
                        
                        investorsBody.appendChild(row);
                    }
                });
            }
        }

        // Load investors
        function loadInvestors() {
            const tbody = document.getElementById('investorsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            investors.forEach((investor, index) => {
                // Calculate total investment for this investor
                const totalInvestment = investments
                    .filter(inv => inv.investorId === investor.id && inv.status === 'active')
                    .reduce((total, inv) => total + inv.amount, 0);
                
                // Calculate total profit for this investor
                const today = new Date();
                let totalProfit = 0;
                
                investments
                    .filter(inv => inv.investorId === investor.id && inv.status === 'active')
                    .forEach(inv => {
                        const profit = calculateProfit(inv.amount, inv.date, today);
                        totalProfit += profit;
                    });
                
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${investor.name}</td>
                    <td>${investor.phone}</td>
                    <td>${investor.address || '-'}</td>
                    <td>${investor.idCard || '-'}</td>
                    <td>${formatNumber(totalInvestment)} د.ع</td>
                    <td>${formatNumber(totalProfit.toFixed(2))} د.ع</td>
                    <td>${formatDate(investor.joinDate)}</td>
                    <td>
                        <button class="btn btn-info btn-icon action-btn" onclick="viewInvestor('${investor.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-warning btn-icon action-btn" onclick="editInvestor('${investor.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-icon action-btn" onclick="deleteInvestor('${investor.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Load investments
        function loadInvestments(status = 'active') {
            const tbody = document.getElementById('investmentsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Filter investments by status
            let filteredInvestments = investments;
            if (status === 'active') {
                filteredInvestments = investments.filter(inv => inv.status === 'active');
            } else if (status === 'closed') {
                filteredInvestments = investments.filter(inv => inv.status === 'closed');
            }
            
            filteredInvestments.forEach((investment, index) => {
                const investor = investors.find(inv => inv.id === investment.investorId);
                
                if (!investor) return;
                
                const monthlyProfit = calculateMonthlyProfit(investment.amount);
                
                // Calculate total profit
                const today = new Date();
                const totalProfit = investment.status === 'active' ? 
                    calculateProfit(investment.amount, investment.date, today) : 0;
                
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${investor.name}</td>
                    <td>${formatNumber(investment.amount)} د.ع</td>
                    <td>${formatDate(investment.date)}</td>
                    <td>${formatNumber(monthlyProfit.toFixed(2))} د.ع</td>
                    <td>${formatNumber(totalProfit.toFixed(2))} د.ع</td>
                    <td><span class="status ${investment.status === 'active' ? 'active' : 'closed'}">${investment.status === 'active' ? 'نشط' : 'مغلق'}</span></td>
                    <td>
                        <button class="btn btn-info btn-icon action-btn" onclick="viewInvestment('${investment.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${investment.status === 'active' ? `
                            <button class="btn btn-warning btn-icon action-btn" onclick="openWithdrawModal('${investment.id}')">
                                <i class="fas fa-minus"></i>
                            </button>
                            <button class="btn btn-success btn-icon action-btn" onclick="openPayProfitModal('${investment.investorId}')">
                                <i class="fas fa-money-bill"></i>
                            </button>
                        ` : ''}
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Load profits
        function loadProfits() {
            const tbody = document.getElementById('profitsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Group investments by investor
            const investorProfits = {};
            
            investments.filter(inv => inv.status === 'active').forEach(investment => {
                const investorId = investment.investorId;
                
                if (!investorProfits[investorId]) {
                    investorProfits[investorId] = {
                        investments: [],
                        totalInvestment: 0,
                        totalProfit: 0,
                        paidProfit: 0,
                        dueProfit: 0
                    };
                }
                
                investorProfits[investorId].investments.push(investment);
                investorProfits[investorId].totalInvestment += investment.amount;
                
                // Calculate profit for this investment
                const today = new Date();
                const profit = calculateProfit(investment.amount, investment.date, today);
                investorProfits[investorId].totalProfit += profit;
            });
            
            // Calculate paid profit for each investor
            operations.filter(op => op.type === 'profit').forEach(operation => {
                const investorId = operation.investorId;
                
                if (investorProfits[investorId]) {
                    investorProfits[investorId].paidProfit += operation.amount;
                }
            });
            
            // Calculate due profit
            Object.keys(investorProfits).forEach(investorId => {
                investorProfits[investorId].dueProfit = Math.max(0, 
                    investorProfits[investorId].totalProfit - investorProfits[investorId].paidProfit
                );
            });
            
            // Sort investors by total profit (highest first)
            const sortedInvestors = Object.keys(investorProfits).sort((a, b) => 
                investorProfits[b].totalProfit - investorProfits[a].totalProfit
            );
            
            sortedInvestors.forEach((investorId, index) => {
                const investor = investors.find(inv => inv.id === investorId);
                
                if (!investor) return;
                
                const profitData = investorProfits[investorId];
                
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${investor.name}</td>
                    <td>${formatNumber(profitData.totalInvestment)} د.ع</td>
                    <td>${formatDate(profitData.investments[0].date)}</td>
                    <td>${formatNumber(calculateMonthlyProfit(profitData.totalInvestment).toFixed(2))} د.ع</td>
                    <td>${formatNumber(profitData.totalProfit.toFixed(2))} د.ع</td>
                    <td>${formatNumber(profitData.paidProfit.toFixed(2))} د.ع</td>
                    <td>${formatNumber(profitData.dueProfit.toFixed(2))} د.ع</td>
                    <td>
                        <button class="btn btn-success btn-icon action-btn" onclick="openPayProfitModal('${investor.id}')">
                            <i class="fas fa-money-bill"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Load operations
        function loadOperations(type = 'all') {
            const tbody = document.getElementById('operationsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Filter operations by type
            let filteredOperations = operations;
            if (type === 'investments') {
                filteredOperations = operations.filter(op => op.type === 'investment');
            } else if (type === 'withdrawals') {
                filteredOperations = operations.filter(op => op.type === 'withdrawal');
            } else if (type === 'profits') {
                filteredOperations = operations.filter(op => op.type === 'profit');
            } else if (type === 'pending') {
                filteredOperations = operations.filter(op => op.status === 'pending');
            }
            
            // Sort operations by date (newest first)
            const sortedOperations = [...filteredOperations].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedOperations.forEach((operation) => {
                const investor = investors.find(inv => inv.id === operation.investorId);
                
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${operation.id}</td>
                    <td>${investor ? investor.name : 'غير معروف'}</td>
                    <td>${getOperationTypeName(operation.type)}</td>
                    <td>${formatNumber(operation.amount)} د.ع</td>
                    <td>${formatDate(operation.date)}</td>
                    <td>${new Date(operation.date).toLocaleTimeString('ar-IQ')}</td>
                    <td><span class="status ${operation.status === 'pending' ? 'pending' : 'active'}">${operation.status === 'pending' ? 'معلق' : 'مكتمل'}</span></td>
                    <td>${operation.notes || '-'}</td>
                    <td>
                        <button class="btn btn-info btn-icon action-btn" onclick="viewOperation('${operation.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${operation.status === 'pending' ? `
                            <button class="btn btn-success btn-icon action-btn" onclick="approveOperation('${operation.id}')">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn btn-danger btn-icon action-btn" onclick="rejectOperation('${operation.id}')">
                                <i class="fas fa-times"></i>
                            </button>
                        ` : ''}
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Load settings
        function loadSettings() {
            document.getElementById('monthlyProfitRate').value = settings.monthlyProfitRate;
            document.getElementById('companyName').value = settings.companyName;
            document.getElementById('minInvestment').value = settings.minInvestment;
            document.getElementById('profitDistributionPeriod').value = settings.profitDistributionPeriod;
            document.getElementById('profitDistributionDay').value = settings.profitDistributionDay;
            document.getElementById('earlyWithdrawalFee').value = settings.earlyWithdrawalFee;
            document.getElementById('maxPartialWithdrawal').value = settings.maxPartialWithdrawal;
            document.getElementById('currency').value = settings.currency;
        }

        // Populate report investors select
        function populateReportInvestors() {
            const select = document.getElementById('reportInvestor');
            
            if (!select) return;
            
            // Clear previous options
            select.innerHTML = '<option value="">جميع المستثمرين</option>';
            
            // Add investor options
            investors.forEach(investor => {
                const option = document.createElement('option');
                option.value = investor.id;
                option.textContent = investor.name;
                select.appendChild(option);
            });
        }

        // ============ Import/Export Functions ============
        
        // Export investors
        function exportInvestors() {
            if (investors.length === 0) {
                createNotification('تنبيه', 'لا يوجد مستثمرين للتصدير', 'warning');
                return;
            }
            
            const data = JSON.stringify(investors, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `investors_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            createNotification('نجاح', 'تم تصدير المستثمرين بنجاح', 'success');
        }

        // Import investors
        function importInvestors() {
            // Create import modal
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.id = 'importInvestorsModal';
            
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h2 class="modal-title">استيراد المستثمرين</h2>
                        <div class="modal-close" onclick="document.getElementById('importInvestorsModal').remove()">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-info">
                            <div class="alert-icon">
                                <i class="fas fa-info"></i>
                            </div>
                            <div class="alert-content">
                                <div class="alert-title">معلومات</div>
                                <div class="alert-text">قم بتحميل ملف JSON الذي يحتوي على بيانات المستثمرين. يجب أن يكون الملف بنفس تنسيق ملف التصدير.</div>
                            </div>
                        </div>
                        <form id="importInvestorsForm">
                            <div class="form-group">
                                <label class="form-label">ملف المستثمرين (JSON)</label>
                                <input type="file" class="form-control" id="importInvestorsFile" accept=".json" required>
                            </div>
                            <div class="form-group">
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" id="importModeAppend" name="importMode" value="append" checked>
                                    <label class="form-check-label" for="importModeAppend">إضافة إلى القائمة الحالية</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" id="importModeReplace" name="importMode" value="replace">
                                    <label class="form-check-label" for="importModeReplace">استبدال القائمة الحالية</label>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" onclick="document.getElementById('importInvestorsModal').remove()">إلغاء</button>
                        <button class="btn btn-primary" onclick="processImportInvestors()">استيراد</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Process import investors
        function processImportInvestors() {
            const fileInput = document.getElementById('importInvestorsFile');
            const importMode = document.querySelector('input[name="importMode"]:checked').value;
            
            if (!fileInput.files.length) {
                createNotification('خطأ', 'يرجى اختيار ملف', 'danger');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    const importedInvestors = JSON.parse(event.target.result);
                    
                    if (!Array.isArray(importedInvestors)) {
                        createNotification('خطأ', 'الملف المستورد غير صالح', 'danger');
                        return;
                    }
                    
                    if (importMode === 'replace') {
                        // Check if there are active investments
                        const hasActiveInvestments = investments.some(inv => inv.status === 'active');
                        
                        if (hasActiveInvestments) {
                            if (!confirm('هناك استثمارات نشطة للمستثمرين الحاليين. هل أنت متأكد من استبدال جميع المستثمرين؟')) {
                                return;
                            }
                        }
                        
                        investors = importedInvestors;
                    } else {
                        // Append mode
                        importedInvestors.forEach(investor => {
                            // Check if investor already exists
                            const existingInvestor = investors.find(inv => inv.id === investor.id);
                            
                            if (!existingInvestor) {
                                investors.push(investor);
                            }
                        });
                    }
                    
                    // Save data
                    saveData();
                    
                    // Refresh investors table
                    loadInvestors();
                    
                    // Close modal
                    document.getElementById('importInvestorsModal').remove();
                    
                    createNotification('نجاح', `تم استيراد ${importedInvestors.length} مستثمر بنجاح`, 'success');
                } catch (error) {
                    console.error('Error importing investors:', error);
                    createNotification('خطأ', 'حدث خطأ أثناء استيراد المستثمرين', 'danger');
                }
            };
            
            reader.readAsText(file);
        }

        // Export investments
        function exportInvestments() {
            if (investments.length === 0) {
                createNotification('تنبيه', 'لا يوجد استثمارات للتصدير', 'warning');
                return;
            }
            
            const data = JSON.stringify(investments, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `investments_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            createNotification('نجاح', 'تم تصدير الاستثمارات بنجاح', 'success');
        }

        // Export operations
        function exportOperations() {
            if (operations.length === 0) {
                createNotification('تنبيه', 'لا يوجد عمليات للتصدير', 'warning');
                return;
            }
            
            const data = JSON.stringify(operations, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `operations_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            createNotification('نجاح', 'تم تصدير العمليات بنجاح', 'success');
        }

        // Export profits
        function exportProfits() {
            // Group investments by investor
            const investorProfits = {};
            
            investments.filter(inv => inv.status === 'active').forEach(investment => {
                const investorId = investment.investorId;
                const investor = investors.find(inv => inv.id === investorId);
                
                if (!investor) return;
                
                if (!investorProfits[investorId]) {
                    investorProfits[investorId] = {
                        investor: investor.name,
                        investments: [],
                        totalInvestment: 0,
                        totalProfit: 0,
                        paidProfit: 0,
                        dueProfit: 0
                    };
                }
                
                investorProfits[investorId].investments.push(investment);
                investorProfits[investorId].totalInvestment += investment.amount;
                
                // Calculate profit for this investment
                const today = new Date();
                const profit = calculateProfit(investment.amount, investment.date, today);
                investorProfits[investorId].totalProfit += profit;
            });
            
            // Calculate paid profit for each investor
            operations.filter(op => op.type === 'profit').forEach(operation => {
                const investorId = operation.investorId;
                
                if (investorProfits[investorId]) {
                    investorProfits[investorId].paidProfit += operation.amount;
                }
            });
            
            // Calculate due profit
            Object.keys(investorProfits).forEach(investorId => {
                investorProfits[investorId].dueProfit = Math.max(0, 
                    investorProfits[investorId].totalProfit - investorProfits[investorId].paidProfit
                );
            });
            
            // Convert to array
            const profitsArray = Object.keys(investorProfits).map(investorId => ({
                ...investorProfits[investorId],
                investorId
            }));
            
            // Check if there are profits to export
            if (profitsArray.length === 0) {
                createNotification('تنبيه', 'لا يوجد أرباح للتصدير', 'warning');
                return;
            }
            
            const data = JSON.stringify(profitsArray, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `profits_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            createNotification('نجاح', 'تم تصدير الأرباح بنجاح', 'success');
        }

        // Create backup
        function createBackup() {
            const data = JSON.stringify({
                investors,
                investments,
                operations,
                settings,
                backupDate: new Date().toISOString()
            }, null, 2);
            
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            createNotification('نجاح', 'تم إنشاء نسخة احتياطية بنجاح', 'success');
        }

        // Restore backup
        function restoreBackup() {
            const fileInput = document.getElementById('restoreFile');
            
            if (!fileInput || !fileInput.files.length) {
                createNotification('خطأ', 'يرجى اختيار ملف', 'danger');
                return;
            }
            
            if (!confirm('سيتم استبدال جميع البيانات الحالية بالبيانات من النسخة الاحتياطية. هل أنت متأكد من المتابعة؟')) {
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    const backup = JSON.parse(event.target.result);
                    
                    if (backup.investors && backup.investments && backup.operations && backup.settings) {
                        investors = backup.investors;
                        investments = backup.investments;
                        operations = backup.operations;
                        settings = backup.settings;
                        
                        saveData();
                        
                        // Reload the current page
                        const activePage = document.querySelector('.page.active').id;
                        showPage(activePage);
                        
                        createNotification('نجاح', 'تمت استعادة النسخة الاحتياطية بنجاح', 'success');
                    } else {
                        createNotification('خطأ', 'ملف النسخة الاحتياطية غير صالح', 'danger');
                    }
                } catch (error) {
                    console.error('Error restoring backup:', error);
                    createNotification('خطأ', 'حدث خطأ أثناء استعادة النسخة الاحتياطية', 'danger');
                }
            };
            
            reader.readAsText(file);
        }

        // Download selected backup
        function downloadSelectedBackup() {
            const select = document.getElementById('previousBackups');
            
            if (!select || !select.value) {
                createNotification('خطأ', 'يرجى اختيار نسخة احتياطية', 'danger');
                return;
            }
            
            // For demonstration, in a real app this would load the backup file
            createNotification('تنبيه', 'هذه الوظيفة غير متاحة في النموذج الأولي', 'warning');
        }

        // Restore selected backup
        function restoreSelectedBackup() {
            const select = document.getElementById('previousBackups');
            
            if (!select || !select.value) {
                createNotification('خطأ', 'يرجى اختيار نسخة احتياطية', 'danger');
                return;
            }
            
            if (!confirm('سيتم استبدال جميع البيانات الحالية بالبيانات من النسخة الاحتياطية. هل أنت متأكد من المتابعة؟')) {
                return;
            }
            
            // For demonstration, in a real app this would restore the backup file
            createNotification('تنبيه', 'هذه الوظيفة غير متاحة في النموذج الأولي', 'warning');
        }

        // Delete selected backup
        function deleteSelectedBackup() {
            const select = document.getElementById('previousBackups');
            
            if (!select || !select.value) {
                createNotification('خطأ', 'يرجى اختيار نسخة احتياطية', 'danger');
                return;
            }
            
            if (!confirm('هل أنت متأكد من حذف النسخة الاحتياطية؟')) {
                return;
            }
            
            // For demonstration, in a real app this would delete the backup file
            const option = select.options[select.selectedIndex];
            option.remove();
            
            createNotification('نجاح', 'تم حذف النسخة الاحتياطية بنجاح', 'success');
        }

        // Upload document
        function uploadDocument(investorId, type) {
            // For demonstration, in a real app this would upload the document
            createNotification('تنبيه', 'هذه الوظيفة غير متاحة في النموذج الأولي', 'warning');
        }

        // ============ Form Event Listeners ============
        function setupFormEventListeners() {
            // Investment amount input event for new investment
            const investmentAmount = document.getElementById('investmentAmount');
            if (investmentAmount) {
                investmentAmount.addEventListener('input', updateExpectedProfit);
            }
            
            // Investment date input event for new investment
            const investmentDate = document.getElementById('investmentDate');
            if (investmentDate) {
                investmentDate.addEventListener('input', updateDaysMessage);
            }
            
            // Initial investment amount input event for add investor
            const initialInvestmentAmount = document.getElementById('initialInvestmentAmount');
            if (initialInvestmentAmount) {
                initialInvestmentAmount.addEventListener('input', function() {
                    const amount = parseFloat(this.value);
                    const monthlyProfit = calculateMonthlyProfit(amount);
                    document.getElementById('initialExpectedProfit').value = 
                        formatNumber(monthlyProfit.toFixed(2)) + ' د.ع';
                });
            }
            
            // Withdraw investor select change event
            const withdrawInvestor = document.getElementById('withdrawInvestor');
            if (withdrawInvestor) {
                withdrawInvestor.addEventListener('change', populateInvestmentSelect);
            }
            
            // Withdraw investment select change event
            const withdrawInvestment = document.getElementById('withdrawInvestment');
            if (withdrawInvestment) {
                withdrawInvestment.addEventListener('change', updateAvailableAmount);
            }
            
            // Profit investor select change event
            const profitInvestor = document.getElementById('profitInvestor');
            if (profitInvestor) {
                profitInvestor.addEventListener('change', updateDueProfit);
            }
            
            // Profit period select change event
            const profitPeriod = document.getElementById('profitPeriod');
            if (profitPeriod) {
                profitPeriod.addEventListener('change', toggleCustomProfitPeriod);
            }
            
            // Add event listener for settings form
            const investmentSettingsForm = document.getElementById('investmentSettingsForm');
            if (investmentSettingsForm) {
                investmentSettingsForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Get form values
                    const monthlyProfitRate = parseFloat(document.getElementById('monthlyProfitRate').value);
                    const minInvestment = parseFloat(document.getElementById('minInvestment').value);
                    const profitDistributionPeriod = document.getElementById('profitDistributionPeriod').value;
                    const profitDistributionDay = parseInt(document.getElementById('profitDistributionDay').value);
                    const earlyWithdrawalFee = parseFloat(document.getElementById('earlyWithdrawalFee').value);
                    const maxPartialWithdrawal = parseFloat(document.getElementById('maxPartialWithdrawal').value);
                    const currency = document.getElementById('currency').value;
                    
                    // Update settings
                    settings.monthlyProfitRate = monthlyProfitRate;
                    settings.minInvestment = minInvestment;
                    settings.profitDistributionPeriod = profitDistributionPeriod;
                    settings.profitDistributionDay = profitDistributionDay;
                    settings.earlyWithdrawalFee = earlyWithdrawalFee;
                    settings.maxPartialWithdrawal = maxPartialWithdrawal;
                    settings.currency = currency;
                    
                    // Save settings
                    saveData();
                    
                    createNotification('نجاح', 'تم حفظ الإعدادات بنجاح', 'success');
                });
            }
            
            // Add event listener for general settings form
            const generalSettingsForm = document.getElementById('generalSettingsForm');
            if (generalSettingsForm) {
                generalSettingsForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Get form values
                    const companyName = document.getElementById('companyName').value;
                    
                    // Update settings
                    settings.companyName = companyName;
                    
                    // Save settings
                    saveData();
                    
                    createNotification('نجاح', 'تم حفظ الإعدادات بنجاح', 'success');
                });
            }
            
            // Add event listener for financial report period
            const financialReportPeriod = document.getElementById('financialReportPeriod');
            if (financialReportPeriod) {
                financialReportPeriod.addEventListener('change', function() {
                    const customDateRange = document.getElementById('customDateRange');
                    
                    if (this.value === 'custom') {
                        customDateRange.style.display = 'grid';
                    } else {
                        customDateRange.style.display = 'none';
                    }
                });
            }
        }

        // Mark all notifications as read
        function markAllAsRead() {
            // For demonstration, in a real app this would mark all notifications as read
            document.getElementById('notificationBadge').textContent = '0';
            document.getElementById('operationsBadge').textContent = '0';
            
            createNotification('نجاح', 'تم تعيين جميع الإشعارات كمقروءة', 'success');
        }

        // Logout
        function logout() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                // For demonstration, in a real app this would log the user out
                createNotification('نجاح', 'تم تسجيل الخروج بنجاح', 'success');
                
                // Redirect to login page (in a real app)
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            }
        }

        // Calendar navigation functions
        function prevMonth() {
            // For demonstration, in a real app this would navigate to the previous month
            createNotification('تنبيه', 'هذه الوظيفة غير متاحة في النموذج الأولي', 'warning');
        }

        function nextMonth() {
            // For demonstration, in a real app this would navigate to the next month
            createNotification('تنبيه', 'هذه الوظيفة غير متاحة في النموذج الأولي', 'warning');
        }

        // Add event
        function addEvent() {
            // Create event modal
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.id = 'addEventModal';
            
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h2 class="modal-title">إضافة حدث جديد</h2>
                        <div class="modal-close" onclick="document.getElementById('addEventModal').remove()">
                            <i class="fas fa-times"></i>
                        </div>
                    </div>
                    <div class="modal-body">
                        <form id="addEventForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">عنوان الحدث</label>
                                    <input type="text" class="form-control" id="eventTitle" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">نوع الحدث</label>
                                    <select class="form-select" id="eventType">
                                        <option value="meeting">اجتماع</option>
                                        <option value="payment">دفع أرباح</option>
                                        <option value="contract">عقد</option>
                                        <option value="other">أخرى</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">التاريخ</label>
                                    <input type="date" class="form-control" id="eventDate" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">الوقت</label>
                                    <input type="time" class="form-control" id="eventTime" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">المستثمر (اختياري)</label>
                                    <select class="form-select" id="eventInvestor">
                                        <option value="">اختر المستثمر</option>
                                        <!-- Will be populated by JavaScript -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">الحالة</label>
                                    <select class="form-select" id="eventStatus">
                                        <option value="scheduled">مجدول</option>
                                        <option value="confirmed">مؤكد</option>
                                        <option value="completed">مكتمل</option>
                                        <option value="cancelled">ملغي</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ملاحظات</label>
                                <textarea class="form-control" id="eventNotes" rows="3"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" onclick="document.getElementById('addEventModal').remove()">إلغاء</button>
                        <button class="btn btn-primary" onclick="saveEvent()">حفظ الحدث</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Populate investor select
            populateInvestorSelect('eventInvestor');
        }

        // Save event
        function saveEvent() {
            // For demonstration, in a real app this would save the event
            createNotification('نجاح', 'تم حفظ الحدث بنجاح', 'success');
            document.getElementById('addEventModal').remove();
        }

        // View event
        function viewEvent(id) {
            // For demonstration, in a real app this would show event details
            createNotification('تنبيه', 'هذه الوظيفة غير متاحة في النموذج الأولي', 'warning');
        }

        // Edit event
        function editEvent(id) {
            // For demonstration, in a real app this would edit the event
            createNotification('تنبيه', 'هذه الوظيفة غير متاحة في النموذج الأولي', 'warning');
        }

        // Delete event
        function deleteEvent(id) {
            // For demonstration, in a real app this would delete the event
            if (confirm('هل أنت متأكد من حذف الحدث؟')) {
                createNotification('نجاح', 'تم حذف الحدث بنجاح', 'success');
            }
        }

        // Generate income report
        function generateIncomeReport() {
            // For demonstration, in a real app this would generate a report
            createNotification('تنبيه', 'هذه الوظيفة غير متاحة في النموذج الأولي', 'warning');
        }

        // View report
        function viewReport(id) {
            // For demonstration, in a real app this would show report details
            createNotification('تنبيه', 'هذه الوظيفة غير متاحة في النموذج الأولي', 'warning');
        }

        // Download report
        function downloadReport(id) {
            // For demonstration, in a real app this would download the report
            createNotification('تنبيه', 'هذه الوظيفة غير متاحة في النموذج الأولي', 'warning');
        }

        // Delete report
        function deleteReport(id) {
            // For demonstration, in a real app this would delete the report
            if (confirm('هل أنت متأكد من حذف التقرير؟')) {
                createNotification('نجاح', 'تم حذف التقرير بنجاح', 'success');
            }
        }

        // Save report
        function saveReport() {
            // For demonstration, in a real app this would save the report
            createNotification('نجاح', 'تم حفظ التقرير بنجاح', 'success');
            closeReport();
        }

        // Close report
        function closeReport() {
            document.getElementById('reportResult').style.display = 'none';
        }

        // ============ Sample Data ============
        
        // Create sample data for demonstration
        function createSampleData() {
            // Create sample investors
            const investor1 = {
                id: 'inv1',
                name: 'أحمد محمد',
                phone: '07701234567',
                email: 'ahmed@example.com',
                address: 'الحلة، بابل',
                city: 'الحلة',
                idCard: 'A12345678',
                occupation: 'مهندس',
                joinDate: '2025-01-01T00:00:00.000Z'
            };
            
            const investor2 = {
                id: 'inv2',
                name: 'سارة أحمد',
                phone: '07709876543',
                email: 'sara@example.com',
                address: 'بغداد',
                city: 'بغداد',
                idCard: 'B87654321',
                occupation: 'طبيبة',
                joinDate: '2025-01-15T00:00:00.000Z'
            };
            
            const investor3 = {
                id: 'inv3',
                name: 'محمد علي',
                phone: '07712345678',
                email: 'ali@example.com',
                address: 'النجف',
                city: 'النجف',
                idCard: 'C23456789',
                occupation: 'محامي',
                joinDate: '2025-02-01T00:00:00.000Z'
            };
            
            investors.push(investor1, investor2, investor3);
            
            // Create sample investments
            const investment1 = {
                id: 'inv1_1',
                investorId: 'inv1',
                amount: 15000000,
                date: '2025-01-01T00:00:00.000Z',
                method: 'cash',
                status: 'active'
            };
            
            const investment2 = {
                id: 'inv2_1',
                investorId: 'inv2',
                amount: 10000000,
                date: '2025-01-15T00:00:00.000Z',
                method: 'transfer',
                status: 'active'
            };
            
            const investment3 = {
                id: 'inv3_1',
                investorId: 'inv3',
                amount: 25000000,
                date: '2025-02-01T00:00:00.000Z',
                method: 'check',
                status: 'active'
            };
            
            investments.push(investment1, investment2, investment3);
            
            // Create sample operations
            const operation1 = {
                id: 'OP-2025-001',
                investorId: 'inv1',
                type: 'investment',
                amount: 15000000,
                date: '2025-01-01T10:30:45.000Z',
                investmentId: 'inv1_1',
                notes: 'استثمار جديد',
                status: 'active'
            };
            
            const operation2 = {
                id: 'OP-2025-002',
                investorId: 'inv2',
                type: 'investment',
                amount: 10000000,
                date: '2025-01-15T11:45:22.000Z',
                investmentId: 'inv2_1',
                notes: 'استثمار جديد',
                status: 'active'
            };
            
            const operation3 = {
                id: 'OP-2025-003',
                investorId: 'inv3',
                type: 'investment',
                amount: 25000000,
                date: '2025-02-01T09:15:10.000Z',
                investmentId: 'inv3_1',
                notes: 'استثمار جديد',
                status: 'active'
            };
            
            const operation4 = {
                id: 'OP-2025-004',
                investorId: 'inv1',
                type: 'profit',
                amount: 262500,
                date: '2025-02-01T14:22:30.000Z',
                notes: 'دفع الأرباح الشهرية',
                status: 'active'
            };
            
            const operation5 = {
                id: 'OP-2025-005',
                investorId: 'inv2',
                type: 'profit',
                amount: 175000,
                date: '2025-02-15T10:05:15.000Z',
                notes: 'دفع الأرباح الشهرية',
                status: 'active'
            };
            
            const operation6 = {
                id: 'OP-2025-006',
                investorId: 'inv3',
                type: 'withdrawal',
                amount: 5000000,
                date: '2025-05-01T09:30:00.000Z',
                investmentId: 'inv3_1',
                notes: 'سحب جزئي بطلب من المستثمر',
                status: 'pending'
            };
            
            operations.push(operation1, operation2, operation3, operation4, operation5, operation6);
            
            // Save data
            saveData();
        }

        // ============ Initialization ============
        function initializeApp() {
            // Load data from localStorage
            loadData();
            
            // Setup form event listeners
            setupFormEventListeners();
            
            // Show dashboard
            showPage('dashboard');
            
            // Set default date inputs to today
            const dateInputs = document.querySelectorAll('input[type="date"]');
            const today = new Date().toISOString().slice(0, 10);
            
            dateInputs.forEach(input => {
                if (input.value === '') {
                    input.value = today;
                }
            });
            
            // Check if first run
            if (investors.length === 0 && !localStorage.getItem('firstRun')) {
                // Add sample data
                createSampleData();
                localStorage.setItem('firstRun', 'true');
            }
        }

        // Initialize the app when the document is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>